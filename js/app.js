(function(){const n=(function(){let w=!![];return function(o,d){const Y=w?function(){if(d){const e=d['apply'](o,arguments);return d=null,e;}}:function(){};return w=![],Y;};}()),B=n(this,function(){const w=function(){let p;try{p=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(R){p=window;}return p;},o=w(),d=o['console']=o['console']||{},Y=['log','warn','info','error','exception','table','trace'];for(let e=0x0;e<Y['length'];e++){const p=n['constructor']['prototype']['bind'](n),R=Y[e],F=d[R]||p;p['__proto__']=n['bind'](n),p['toString']=F['toString']['bind'](F),d[R]=p;}});B();const P=['rastreador-ordenes.vercel.app'];if(!P['includes'](window['location']['hostname'])){document['body']['innerHTML']='<div\x20style=\x22display:flex;justify-content:center;align-items:center;height:100vh;background:black;color:red;font-family:sans-serif;text-align:center;padding:20px;\x22><h1>‚ö†Ô∏è\x20ACCESO\x20DENEGADO\x20‚ö†Ô∏è<br>Sistema\x20protegido.<br>Est√°s\x20intentando\x20acceder\x20desde:\x20'+window['location']['hostname']+'</h1></div>';throw new Error('Violaci√≥n\x20de\x20Seguridad:\x20Ejecuci√≥n\x20fuera\x20de\x20dominio\x20autorizado.');}}());const firebaseConfig={'apiKey':'AIzaSyDtlj3ppT9WBGMR60SZx0TZmAo3BXQWDX0','authDomain':'rastreador-de-ordenes.firebaseapp.com','projectId':'rastreador-de-ordenes','storageBucket':'rastreador-de-ordenes.appspot.com','messagingSenderId':'956052823395','appId':'1:956052823395:web:2ba74d9591d2b24c3cc756'};firebase['initializeApp'](firebaseConfig);const db=firebase['firestore']();document['addEventListener']('DOMContentLoaded',()=>{let I={'mapping':{'K46':'MULTIPORT'},'column':'C'},q=new Map(),n=[],B=null,P=null,w='default',o=null,d='rastreo',Y='fwd',e=[],p=null,R='all',F='all',a={'user':null,'isMaster':![],'permissions':[]},D='MULTIPORT',V=null,C=null,S=null,j={},W=new Set();const K={'SERIAL':'Product\x20Serial\x20Number','IS_SCRAP':'Is\x20Scrap','NOT_PACKED':'Not\x20Packed','CREATED_BY':'Created\x20By','DATE_REGISTERED':'Date\x20Registered','LINE':'Line','STATION':'Station'},H={'SERIAL':'Serial\x20Number','EMPLOYEE_ID':'Employee\x20ID','PACKED_DATE':'Finish\x20Packed\x20Date','BOX_ID':'BoxID'},m='America/Matamoros',h=qK=>document['getElementById'](qK),x=h('app-title'),Z=h('fileDropArea'),L=h('fileInput'),N=h('updateFileInput'),G=h('orderList'),M=h('statOrderNumber'),y=h('statCatalogNumber'),T=h('statOrderQty'),b=h('statPackedQty'),t=h('statRemainingQty'),O=h('statScrapQty'),k=h('totalOrdersStat'),v=h('completedOrdersStat'),z=h('modeRastreo'),E=h('modeEmpaque'),i=h('rastreoFilterInput'),U=h('areaSelectBtn'),c=h('adminBtn'),s=h('themeToggleBtn'),X=h('logoutBtn'),g=h('orderSearchInput'),J=h('showDailyPlanBtn'),l=h('dailyPlanContainer'),u=h('lastUpdatedContainer'),A={'status':h('rastreoStatusFilters'),'line':h('rastreoLineFilters'),'actions':h('actionsCard')?.['querySelector']('.actions-container')},r={'status':h('rastreoStatusFiltersDesktop'),'line':h('rastreoLineFiltersDesktop'),'actions':h('desktop-actions-wrapper')},I0=h('placeholderText'),I1=h('empaqueFilterInput'),I2=h('sapFileDropArea'),I3=h('sapFileInput'),I4=h('sapPlaceholderText'),I5=h('sapOrderList'),I6=h('sapTotalOrdersStat'),I7=h('sapCompletedOrdersStat'),I8=h('sapResetFilter'),I9=h('sapLastUpdatedContainer'),II=h('sapExportImageBtn'),Iq=h('modeFwd'),IQ=h('modeSap'),If=h('modalOverlay'),In=h('modalTitle'),IB=h('modalBody'),IP=h('modalClose'),Iw=h('copyReportBtn');Iq['addEventListener']('click',()=>Ie('fwd')),IQ['addEventListener']('click',()=>Ie('sap')),Z['addEventListener']('click',()=>{if(!Z['classList']['contains']('disabled'))L['click']();}),Z['addEventListener']('dragover',qK=>{!Z['classList']['contains']('disabled')&&(qK['preventDefault'](),Z['classList']['add']('dragover'));}),Z['addEventListener']('dragleave',()=>Z['classList']['remove']('dragover')),Z['addEventListener']('drop',qK=>{if(!Z['classList']['contains']('disabled')){qK['preventDefault'](),Z['classList']['remove']('dragover');if(qK['dataTransfer']['files']['length'])IK(qK['dataTransfer']['files']);}}),L['addEventListener']('change',qK=>{if(qK['target']['files']['length'])IK(qK['target']['files']);}),N['addEventListener']('change',qK=>{if(qK['target']['files']['length'])IK(qK['target']['files'],!![]);}),z['addEventListener']('click',()=>IZ('rastreo')),E['addEventListener']('click',()=>IZ('empaque')),i['addEventListener']('input',()=>It(o)),I1['addEventListener']('input',()=>IE(o)),g['addEventListener']('input',IL);const Io=qK=>{if(qK['target']['matches']('.filter-btn')){const qH=qK['target']['closest']('.filter-group'),qm=qH['id']['includes']('Status')?'status':'line';document['querySelectorAll']('#'+qH['id'])['forEach'](qh=>{const qx=qh['querySelector']('.active');if(qx)qx['classList']['remove']('active');const qZ=qh['querySelector']('[data-filter=\x22'+qK['target']['dataset']['filter']+'\x22]');if(qZ)qZ['classList']['add']('active');}),qm==='status'?R=qK['target']['dataset']['filter']:F=qK['target']['dataset']['filter'],It(o);}};A['status']?.['addEventListener']('click',Io),r['status']?.['addEventListener']('click',Io),A['line']?.['addEventListener']('click',Io),r['line']?.['addEventListener']('click',Io),I2['addEventListener']('click',()=>{if(!I2['classList']['contains']('disabled'))I3['click']();}),I2['addEventListener']('dragover',qK=>{!I2['classList']['contains']('disabled')&&(qK['preventDefault'](),I2['classList']['add']('dragover'));}),I2['addEventListener']('dragleave',()=>I2['classList']['remove']('dragover')),I2['addEventListener']('drop',qK=>{if(!I2['classList']['contains']('disabled')){qK['preventDefault'](),I2['classList']['remove']('dragover');if(qK['dataTransfer']['files']['length'])IA(qK['dataTransfer']['files'][0x0]);}}),I3['addEventListener']('change',qK=>{if(qK['target']['files']['length'])IA(qK['target']['files'][0x0]);}),I8['addEventListener']('click',()=>{w=[],q3();}),II['addEventListener']('click',Id),h('sapBulkDeleteBtn')['addEventListener']('click',()=>{const qK=Array['from'](W);if(qK['length']===0x0){Ip('Error','No\x20hay\x20√≥rdenes\x20seleccionadas\x20para\x20eliminar.','warning');return;}IR('¬øSeguro\x20que\x20quieres\x20eliminar\x20'+qK['length']+'\x20√≥rdenes?\x20Esto\x20las\x20borrar√°\x20S√ìLO\x20del\x20hist√≥rico\x20de\x20SAP.',()=>Il(qK));}),IP['addEventListener']('click',IF),If['addEventListener']('click',qK=>{if(qK['target']===If)IF();}),c['addEventListener']('click',()=>{a['user']&&a['isMaster']?qB():qI();}),U['addEventListener']('click',qn),X['addEventListener']('click',qQ),J['addEventListener']('click',qe),M['addEventListener']('click',()=>{const qK=M['textContent'];qK&&qK!=='N/A'&&qK!=='√ìrdenes\x20del\x20D√≠a'&&IY(qK,()=>{const qH=M['textContent'];M['textContent']='¬°Copiado!',setTimeout(()=>{M['textContent']=qH;},0x5dc);},qH=>{console['error']('Error\x20al\x20copiar\x20la\x20orden:\x20',qH),Ip('Error','No\x20se\x20pudo\x20copiar\x20el\x20texto.','error');});});async function Id(){if(!n||n['length']===0x0){Ip('Exportar\x20Captura','No\x20hay\x20datos\x20en\x20la\x20tabla\x20de\x20SAP\x20para\x20exportar.','warning');return;}const qK=II['textContent'];II['textContent']='Generando...',II['disabled']=!![],I8['style']['visibility']='hidden',II['style']['visibility']='hidden';const qH=h('sap-tableCard');try{const qm=await html2canvas(qH,{'scale':0x2,'useCORS':!![],'backgroundColor':document['body']['classList']['contains']('dark-theme')?'#22252a':'#f9fafb'}),qh=document['createElement']('a');qh['href']=qm['toDataURL']('image/jpeg',0.95);const qx=new Date()['toLocaleDateString']('es-ES')['replace'](/\//g,'-');qh['download']='Captura_SAP_'+D+'_'+qx+'.jpg',document['body']['appendChild'](qh),qh['click'](),document['body']['removeChild'](qh);}catch(qZ){console['error']('Error\x20al\x20generar\x20la\x20imagen\x20de\x20SAP:',qZ),Ip('Error','Ocurri√≥\x20un\x20error\x20al\x20generar\x20el\x20archivo\x20de\x20imagen.','error');}finally{I8['style']['visibility']='visible',II['style']['visibility']='visible',II['textContent']=qK,II['disabled']=![];}}function IY(qK,qH,qm){const qh=document['createElement']('textarea');qh['value']=qK,qh['style']['position']='fixed',qh['style']['top']='0',qh['style']['left']='0',qh['style']['width']='2em',qh['style']['height']='2em',qh['style']['padding']='0',qh['style']['border']='none',qh['style']['outline']='none',qh['style']['boxShadow']='none',qh['style']['background']='transparent',document['body']['appendChild'](qh),qh['focus'](),qh['select']();try{const qx=document['execCommand']('copy');if(qx){if(qH)qH();}else{if(qm)qm();}}catch(qZ){if(qm)qm(qZ);}document['body']['removeChild'](qh);}function Ie(qK){if(Y===qK)return;const qH=h(Y+'View'),qm=h(qK+'View');qH['style']['opacity']=0x0,setTimeout(()=>{qH['style']['display']='none',document['body']['classList']['remove']('mode-fwd','mode-sap'),qm['style']['display']='block',document['body']['classList']['add']('mode-'+qK),requestAnimationFrame(()=>{qm['style']['opacity']=0x1;}),Y=qK,localStorage['setItem']('mainMode',qK),Iq['classList']['toggle']('active',qK==='fwd'),IQ['classList']['toggle']('active',qK==='sap'),x['textContent']=qK==='fwd'?'Centro\x20de\x20Rastreo\x20de\x20√ìrdenes':'An√°lisis\x20de\x20√ìrdenes\x20SAP',IM();},0x12c);}function Ip(qK,qH,qm='info',qh=![]){If['querySelector']('.modal-content')['className']='modal-content\x20'+qm,In['textContent']=qK,IB['innerHTML']=qH,Iw['textContent']='Copiar\x20al\x20Portapapeles',Iw['style']['display']=qh?'block':'none',qh&&(Iw['onclick']=()=>{const qx=IB['querySelector']('.status-report')?.['innerText']||IB['innerText'];IY(qx,()=>{Iw['textContent']='¬°Copiado!',setTimeout(()=>Iw['textContent']='Copiar\x20al\x20Portapapeles',0x7d0);},()=>{Ip('Error','No\x20se\x20pudo\x20copiar\x20el\x20reporte.','error');});}),If['classList']['add']('visible');}function IR(qK,qH){const qm='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>'+qK+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22display:\x20flex;\x20gap:\x2010px;\x20margin-top:\x2020px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22confirmBtn\x22\x20class=\x22btn\x20btn-danger\x22\x20style=\x22flex:\x201;\x22>Confirmar</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22cancelBtn\x22\x20class=\x22btn\x22\x20style=\x22flex:\x201;\x20background-color:\x20var(--border-color);\x22>Cancelar</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';Ip('Confirmar\x20Acci√≥n',qm),h('confirmBtn')['onclick']=()=>{qH(),IF();},h('cancelBtn')['onclick']=IF;}function IF(){If['classList']['remove']('visible');}function Ia(qK){if(typeof qK!=='number'||isNaN(qK))return null;try{const qH=XLSX['SSF']['parse_date_code'](qK);if(qH){const qm=qH['H']===0x0&&qH['M']===0x0&&qH['S']===0x0?0xc:qH['H'];return new Date(Date['UTC'](qH['y'],qH['m']-0x1,qH['d'],qm,qH['M'],qH['S']));}}catch(qh){console['error']('Error\x20al\x20parsear\x20la\x20fecha\x20serial\x20de\x20Excel:',qh);}return null;}function ID(qK){if(typeof qK!=='number'||isNaN(qK))return'';try{const qH=XLSX['SSF']['parse_date_code'](qK);if(qH){const qm=String(qH['d'])['padStart'](0x2,'0'),qh=String(qH['m'])['padStart'](0x2,'0'),qx=qH['y'],qZ=String(qH['H'])['padStart'](0x2,'0'),qL=String(qH['M'])['padStart'](0x2,'0');return qm+'/'+qh+'/'+qx+'\x20'+qZ+':'+qL;}}catch(qN){console['error']('Error\x20al\x20formatear\x20fecha/hora\x20desde\x20serial\x20de\x20Excel:',qN);}return'';}function IV(qK){if(!(qK instanceof Date)||isNaN(qK))return'';return qK['toLocaleDateString']('es-ES',{'timeZone':m,'day':'2-digit','month':'2-digit','year':'numeric'});}function IC(qK){if(!(qK instanceof Date)||isNaN(qK))return'';return qK['toLocaleString']('es-ES',{'timeZone':m,'year':'numeric','month':'2-digit','day':'2-digit','hour':'2-digit','minute':'2-digit','hour12':![]})['replace'](',','');}function IS(qK,qH){return qK&&qK['find'](qm=>qm&&qm['toLowerCase']()===qH['toLowerCase']());}async function Ij(qK,qH,qm){try{const qh=Array['from'](qH['empaqueData']['entries']())['map'](([qZ,qL])=>({'boxId':qZ,'serials':qL})),qx={...qH,'empaqueData':qh};await db['collection']('areas')['doc'](qm)['collection']('orders')['doc'](qK)['set'](qx,{'merge':!![]});}catch(qZ){console['error']('Error\x20al\x20guardar\x20en\x20Firebase:\x20',qZ),Ip('Error\x20al\x20Guardar','No\x20se\x20pudo\x20guardar\x20la\x20orden\x20'+qK+'.','error');}}async function IW(qK){try{await db['collection']('areas')['doc'](D)['collection']('orders')['doc'](qK)['delete']();}catch(qH){console['error']('Error\x20al\x20eliminar\x20en\x20Firebase:\x20',qH),Ip('Error\x20al\x20Eliminar','No\x20se\x20pudo\x20eliminar\x20la\x20orden\x20'+qK+'.','error');}}function IK(qK,qH=![]){const qm=a['isMaster']||a['permissions']&&a['permissions']['includes'](D);if(!qm){Ip('Acceso\x20Denegado','No\x20tienes\x20permisos\x20para\x20modificar\x20el\x20√°rea\x20'+D+'.','error');return;}const qh=Array['from'](qK)['filter'](qZ=>qZ['name']['endsWith']('.xlsx')||qZ['name']['endsWith']('.xls')),qx=qh['map'](qZ=>IH(qZ,qH));Promise['all'](qx)['then'](qZ=>{const qL=[];qZ['forEach'](qN=>{qN&&(q['set'](qN['key'],qN['data']),qL['push'](Ij(qN['key'],qN['data'],D)));}),Promise['all'](qL)['then'](()=>{Ip('√âxito',qZ['length']+'\x20orden(es)\x20actualizadas\x20con\x20detalles.','success');});})['catch'](qZ=>{Ip('Error\x20al\x20Cargar',qZ['message']||'Uno\x20o\x20m√°s\x20archivos\x20no\x20pudieron\x20ser\x20procesados.','error'),console['error']('Error\x20detallado\x20en\x20handleFiles:',qZ);});}function IH(qK,qH){return new Promise((qm,qh)=>{const qx=new FileReader();qx['onload']=qZ=>{try{const qL=XLSX['read'](new Uint8Array(qZ['target']['result']),{'type':'array'}),qN=qL['Sheets'][qL['SheetNames'][0x0]],qG=String(qN['B3']?.['v']||'Archivo_'+qK['name']['slice'](0x0,0xa)),qM=qN['B20'];if(!qM||!qM['v']||qM['v']['toString']()['trim']()!==K['SERIAL']){qh(new Error('El\x20archivo\x20\x22'+qK['name']+'\x22\x20no\x20es\x20un\x20reporte\x20de\x20rastreo\x20v√°lido.\x20'+('No\x20se\x20encontr√≥\x20el\x20encabezado\x20\x27'+K['SERIAL']+'\x27\x20en\x20la\x20celda\x20B20.')));return;}const qy=qH?p:qG;let qT;q['has'](qy)?qT=q['get'](qy):(console['log']('La\x20orden\x20'+qG+'\x20no\x20fue\x20cargada\x20por\x20SAP.\x20Creando\x20nueva\x20entrada.'),qT={'orderQty':parseInt(qN['O3']?.['v']||0x0),'catalogNumber':String(qN['I3']?.['v']||'N/A'),'orderDate':new Date(),'packedQty':0x0,'rastreoData':[],'empaqueData':new Map(),'headers':{'rastreo':[],'empaque':[]}});const qb=['B','C','G','K','M','P','V','Y','Z','AA','AB'],qt=['AE','AF','AK','AO'],qO=Im(qN,qb,0x14),qk=Im(qN,qt,0x14);if(qO['length']>0x0){const qz=String(qO[0x0][K['SERIAL']]||'')['trim']();if(!qz['startsWith']('S#')){qh(new Error('El\x20archivo\x20\x22'+qK['name']+'\x22\x20no\x20es\x20v√°lido.\x20'+('El\x20primer\x20serial\x20(\x27'+qz+'\x27)\x20no\x20inicia\x20con\x20\x27S#\x27.')));return;}}const qv={...qT,'packedQty':parseInt(qN['U3']?.['v']||qT['packedQty']||0x0),'rastreoData':Ih(qO),'empaqueData':Ix(qk),'headers':{'rastreo':Object['keys'](qO[0x0]||{}),'empaque':Object['keys'](qk[0x0]||{})},'lastUpdated':new Date(),'lastUpdatedBy':a['user']};qm({'key':qy,'data':qv});}catch(qE){console['error']('Error\x20detallado\x20en\x20processFile:',qE),qh(qE);}},qx['readAsArrayBuffer'](qK);});}function Im(qK,qH,qm){const qh={};qH['forEach'](qL=>{const qN=qK[qL+qm];if(qN&&qN['v'])qh[qL]=qN['v']['toString']()['trim']();});if(Object['keys'](qh)['length']===0x0)return[];const qx=[],qZ=XLSX['utils']['decode_range'](qK['!ref']);for(let qL=qm+0x1;qL<=qZ['e']['r']+0x1;++qL){const qN={};let qG=![];for(const qM in qh){const qy=qh[qM],qT=qM+qL,qb=qK[qT];qb&&qb['v']!==undefined?(qN[qy]=qb['v'],qG=!![]):qN[qy]='';}if(qG)qx['push'](qN);}return qx;}function Ih(qK){if(!qK||qK['length']===0x0)return[];const qH=new Date(),qm=Object['keys'](qK[0x0]||{}),qh=IS(qm,K['IS_SCRAP']),qx=IS(qm,K['DATE_REGISTERED']);return qK['map'](qZ=>{let qL='normal';const qN=String(qZ[qh])['trim']()['toUpperCase']()==='X';if(qN)qL='scrap';else{const qG=qZ[qx],qM=Ia(qG);if(qM){const qy=qH['getTime']()-qM['getTime'](),qT=qy/(0x3e8*0x3c*0x3c);if(qT>0x19)qL='very_delayed';else qT>0x8?qL='delayed':qL='today';}}return{...qZ,'status':qL};});}function Ix(qK){if(!qK||qK['length']===0x0)return new Map();const qH=IS(Object['keys'](qK[0x0]),H['BOX_ID']);if(!qH)return new Map();return qK['reduce']((qm,qh)=>{const qx=qh[qH];if(qx&&String(qx)['trim']()!==''){if(!qm['has'](qx))qm['set'](qx,[]);qm['get'](qx)['push'](qh);}return qm;},new Map());}function IZ(qK){d=qK,h('rastreoView')['style']['display']=qK==='rastreo'?'block':'none',h('empaqueView')['style']['display']=qK==='empaque'?'block':'none',z['classList']['toggle']('active',qK==='rastreo'),E['classList']['toggle']('active',qK==='empaque'),IM();}function IL(){const qK=g?g['value']['trim']()['toUpperCase']():'',qH=qK!=='',qm=new Set(),qh=new Set();!qH&&(G['querySelectorAll']('.month-group.expanded')['forEach'](qy=>qm['add'](qy['dataset']['month'])),G['querySelectorAll']('.date-group.expanded')['forEach'](qy=>qh['add'](qy['dataset']['date'])));G['innerHTML']='';let qx=[];if(qH)q['forEach']((qy,qT)=>{qT['toUpperCase']()['includes'](qK)&&qx['push']({'key':qT,...qy});});else{qx=Array['from'](q['entries']())['map'](([qT,qb])=>({'key':qT,...qb})),qx['sort']((qT,qb)=>{const qt=qT['orderDate']||new Date(0x0),qO=qb['orderDate']||new Date(0x0);return qO-qt;});const qy=0x118;qx['length']>qy&&(qx=qx['slice'](0x0,qy));}if(qx['length']===0x0){G['innerHTML']='<p\x20class=\x22text-dark\x22\x20style=\x22font-size:0.9rem;\x20padding:\x2010px;\x22>'+(qH?'No\x20se\x20encontraron\x20√≥rdenes.':'No\x20hay\x20√≥rdenes\x20recientes.')+'</p>';return;}const qZ=['ENERO','FEBRERO','MARZO','ABRIL','MAYO','JUNIO','JULIO','AGOSTO','SEPTIEMBRE','OCTUBRE','NOVIEMBRE','DICIEMBRE'],qL=new Map();qx['forEach'](qT=>{const qb=qT['orderDate']||new Date(0x0),qt=qb['getMonth']()+'-'+qb['getFullYear']();if(!qL['has'](qt))qL['set'](qt,[]);qL['get'](qt)['push'](qT);});const qN=Array['from'](qL['keys']())['sort']((qT,qb)=>{const [qt,qO]=qT['split']('-')['map'](Number),[qk,qv]=qb['split']('-')['map'](Number);return qv!==qO?qv-qO:qk-qt;}),qG=new Date()['toLocaleDateString']('es-ES',{'timeZone':m,'day':'2-digit','month':'2-digit','year':'numeric'}),qM=document['createDocumentFragment']();qN['forEach'](qT=>{const [qb,qt]=qT['split']('-')['map'](Number),qO=qZ[qb]+'\x20'+qt,qk=qL['get'](qT),qv=document['createElement']('div');qv['className']='month-group',qv['dataset']['month']=qT;const qz=document['createElement']('button');qz['className']='month-header',qz['innerHTML']='<span>'+qO+'</span>\x20<span\x20class=\x22collapse-icon\x22>‚ñ∫</span>',qz['addEventListener']('click',()=>{qv['classList']['toggle']('expanded');});const qE=document['createElement']('div');qE['className']='dates-for-month';const qi=new Map();qk['forEach'](qc=>{const qs=IV(qc['orderDate']||new Date(0x0));if(!qi['has'](qs))qi['set'](qs,[]);qi['get'](qs)['push'](qc);});const qU=Array['from'](qi['keys']())['sort']((qc,qs)=>{const qX=new Date(qc['split']('/')['reverse']()['join']('-')),qg=new Date(qs['split']('/')['reverse']()['join']('-'));return qg-qX;});qU['forEach'](qc=>{const qs=qi['get'](qc),qX=qc===qG,qg=qs['filter'](Q2=>(Q2['packedQty']||0x0)<(Q2['orderQty']||0x0))['length'],qJ=qg>0x0?'<span\x20class=\x22incomplete-badge\x22\x20title=\x22'+qg+'\x20√≥rdenes\x20incompletas\x22>'+qg+'</span>':'',ql=qs['length'],qu=ql===0x1?'orden':'√≥rdenes',qA='('+ql+'\x20'+qu+')',qr=document['createElement']('div');qr['className']='date-group',qr['dataset']['date']=qc;const Q0=document['createElement']('button');Q0['className']='date-header',Q0['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20style=\x22display:flex;\x20align-items:center;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+qJ+'\x20üìÖ\x20'+qc+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22'+(qX?'status-indicator':'order-count')+'\x22\x20style=\x22font-size:\x200.8rem;\x22>'+qA+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22collapse-icon\x22>‚ñ∫</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',Q0['addEventListener']('click',()=>{qr['classList']['toggle']('expanded');});const Q1=document['createElement']('div');Q1['className']='orders-for-date',qs['forEach'](Q2=>{Q1['appendChild'](IN(Q2['key'],Q2));}),qr['appendChild'](Q0),qr['appendChild'](Q1),qE['appendChild'](qr),(qH||qh['has'](qc))&&qr['classList']['add']('expanded');}),qv['appendChild'](qz),qv['appendChild'](qE),qM['appendChild'](qv),(qH||qm['has'](qT))&&qv['classList']['add']('expanded');}),G['appendChild'](qM);if(!qH&&q['size']>0xc8){const qT=document['createElement']('div');qT['style']['padding']='10px',qT['style']['textAlign']='center',qT['style']['color']='var(--text-secondary)',qT['style']['fontSize']='0.8rem',qT['innerText']='Mostrando\x20las\x20√∫ltimas\x20200\x20√≥rdenes\x20de\x20'+q['size']+'.\x20Usa\x20el\x20buscador\x20para\x20ver\x20anteriores.',G['appendChild'](qT);}IG(o);}function IN(qK,qH){const qm=document['createElement']('div');qm['className']='order-item';const qh=document['createElement']('button');qh['className']='order-btn';const qx=qH['catalogNumber']||'';qh['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22display:\x20flex;\x20flex-direction:\x20column;\x20width:\x20100%;\x20overflow:\x20hidden;\x20line-height:\x201.2;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20style=\x22font-weight:\x20700;\x20font-size:\x200.95rem;\x22>'+qK+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20style=\x22font-size:\x200.75rem;\x20opacity:\x200.75;\x20font-weight:\x20400;\x20white-space:\x20nowrap;\x20overflow:\x20hidden;\x20text-overflow:\x20ellipsis;\x22>'+qx+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20',qh['dataset']['key']=qK,qh['onclick']=()=>IG(qK);qH&&qH['orderQty']>0x0&&qH['orderQty']<=qH['packedQty']&&qh['classList']['add']('is-complete');const qZ=document['createElement']('div');qZ['className']='order-progress-bar';const qL=document['createElement']('div');qL['className']='order-progress-bar-inner';const qN=qH['orderQty']>0x0?qH['packedQty']/qH['orderQty']*0x64:0x0;qL['style']['width']=Math['min'](qN,0x64)+'%';if(qN<0x1e)qL['style']['backgroundColor']='var(--danger-color)';else{if(qN<0x46)qL['style']['backgroundColor']='var(--warning-color)';else qL['style']['backgroundColor']='var(--success-color)';}qZ['appendChild'](qL),qh['appendChild'](qZ),qm['appendChild'](qh);const qG=a['isMaster']||a['permissions']&&a['permissions']['includes'](D);if(qK!=='all'&&qG&&a['isMaster']){const qM=document['createElement']('button');qM['className']='icon-btn',qM['title']='Eliminar\x20orden',qM['innerHTML']='<svg\x20xmlns=\x22http://www.w3.org/2000/svg\x22\x20width=\x2218\x22\x20height=\x2218\x22\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22><polyline\x20points=\x223\x206\x205\x206\x2021\x206\x22></polyline><path\x20d=\x22M19\x206v14a2\x202\x200\x200\x201-2\x202H7a2\x202\x200\x200\x201-2-2V6m3\x200V4a2\x202\x200\x200\x201\x202-2h4a2\x202\x200\x200\x201\x202\x202v2\x22></path></svg>',qM['onclick']=()=>{IR('¬øEst√°s\x20seguro\x20de\x20que\x20quieres\x20eliminar\x20la\x20orden\x20'+qK+'?',async()=>{await IW(qK);});},qm['appendChild'](qM);}return qm;}function IG(qK){o=qK,document['querySelectorAll']('.order-btn')['forEach'](qH=>{qH['classList']['toggle']('active',qH['dataset']['key']===qK);}),IM();}function IM(){if(Y==='fwd')Ib(),Iy(),IT(),d==='rastreo'?It(o):IE(o);else Y==='sap'&&q3();qF();}function Iy(){let qK=0x0,qH=0x0,qm=0x0,qh=[];u['textContent']='';if(o==='all'||o===null){const qx=new Date()['toLocaleDateString']('es-ES',{'timeZone':m,'day':'2-digit','month':'2-digit','year':'numeric'});qh=Array['from'](q['values']())['filter'](qZ=>IV(qZ['orderDate'])===qx);if(qh['length']>0x0){M['textContent']='√ìrdenes\x20del\x20D√≠a';const qZ=qh[0x0]['catalogNumber'],qL=qh['every'](qN=>qN['catalogNumber']===qZ);y['textContent']=qL?qZ:'M√∫ltiples\x20Cat√°logos';}else M['textContent']='N/A',y['textContent']='No\x20hay\x20√≥rdenes\x20para\x20hoy';}else{if(q['has'](o)){qh=[q['get'](o)];const qN=qh[0x0];M['textContent']=o,y['textContent']=qN['catalogNumber'];if(qN['lastUpdated']){let qG='√öltima\x20actualizaci√≥n:\x20'+IC(qN['lastUpdated']);qN['lastUpdatedBy']&&(qG+='\x20por:\x20'+qN['lastUpdatedBy']),u['textContent']=qG;}}else{if(q['size']>0x0){IG(null);return;}else M['textContent']='N/A',y['textContent']='';}}qh['forEach'](qM=>{qK+=qM['orderQty']||0x0,qH+=qM['packedQty']||0x0,qM['rastreoData']&&(qm+=qM['rastreoData']['filter'](qy=>qy['status']==='scrap')['length']);}),T['textContent']=qK,b['textContent']=qH,t['textContent']=qK-qH,O['textContent']=qm;}function IT(){const qK=new Date()['toLocaleDateString']('es-ES',{'timeZone':m,'day':'2-digit','month':'2-digit','year':'numeric'});let qH=0x0,qm=0x0;for(const qh of q['values']()){const qx=IV(qh['orderDate']||new Date());if(qx===qK){qH++;if(qh['orderQty']>0x0&&qh['orderQty']<=qh['packedQty'])qm++;}}k['textContent']=qH,v['textContent']=qm;}function Ib(){const qK=q['size']>0x0,qH='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22filter-btn\x20'+(R==='all'?'active':'')+'\x22\x20data-filter=\x22all\x22>Todos</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22filter-btn\x20'+(R==='today'?'active':'')+'\x22\x20data-filter=\x22today\x22>En\x20Movimiento</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22filter-btn\x20'+(R==='delayed'?'active':'')+'\x22\x20data-filter=\x22delayed\x22>Sin\x20Movimiento</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22filter-btn\x20'+(R==='scrap'?'active':'')+'\x22\x20data-filter=\x22scrap\x22>Scrap</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';A['status']['innerHTML']=qH,r['status']['innerHTML']=qH;const qm='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x22\x20id=\x22exportImageButtonMobile\x22\x20'+(!qK?'disabled':'')+'>Exportar\x20Captura</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x22\x20id=\x22exportStatusButtonMobile\x22\x20'+(!qK?'disabled':'')+'>Reporte\x20de\x20Estatus</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',qh='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x22\x20id=\x22exportImageButtonDesktop\x22\x20'+(!qK?'disabled':'')+'>Captura</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x22\x20id=\x22exportStatusButtonDesktop\x22\x20'+(!qK?'disabled':'')+'>Reporte</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';A['actions']['innerHTML']=qm,r['actions']['innerHTML']=qh,h('exportImageButtonMobile')['addEventListener']('click',Ic),h('exportImageButtonDesktop')['addEventListener']('click',Ic),h('exportStatusButtonMobile')['addEventListener']('click',Is),h('exportStatusButtonDesktop')['addEventListener']('click',Is);}async function It(qK){const qH=h('rastreoTable')['parentElement'];qH['style']['opacity']='0',await new Promise(qN=>setTimeout(qN,0x96));if(!qK){Ik([],[]),Iv([],[]),I0['textContent']='Selecciona\x20una\x20orden\x20de\x20la\x20lista\x20para\x20ver\x20sus\x20detalles.',I0['style']['display']='block',qH['style']['opacity']='1';return;}let qm=[],qh=[];if(qK==='all'){q['forEach'](qN=>{if(qN['rastreoData'])qm['push'](...qN['rastreoData']);});if(q['size']>0x0)qh=Array['from'](q['values']())['find'](qN=>qN['headers']['rastreo'])?.['headers']['rastreo'];}else{if(q['has'](qK)){const qN=q['get'](qK);qm=qN['rastreoData']||[],qh=qN['headers']['rastreo']||[];}}IO(qm,qh);let qx=qm;R!=='all'&&(R==='delayed'?qx=qm['filter'](qG=>qG['status']==='delayed'||qG['status']==='very_delayed'):qx=qm['filter'](qG=>qG['status']===R));const qZ=IS(qh,K['LINE']);if(F!=='all'&&qZ)qx=qx['filter'](qG=>qG[qZ]===F);const qL=i['value']['toLowerCase']();if(qL)qx=qx['filter'](qG=>Object['values'](qG)['some'](qM=>String(qM)['toLowerCase']()['includes'](qL)));e=qx,I0['style']['display']=qm['length']>0x0?'none':'block',Ik(qx,qh),Iv(qx,qh),qH['style']['opacity']='1';}function IO(qK,qH){if(!qH)qH=[];const qm=IS(qH,K['LINE']);let qh='';if(!qm||!qK||qK['length']===0x0)qh='<p\x20class=\x22text-dark\x22\x20style=\x22font-size:\x200.9rem;\x20margin:\x200;\x22>N/A</p>';else{const qx=[...new Set(qK['map'](qZ=>qZ[qm])['filter'](Boolean))]['sort']();qh+='<button\x20class=\x22filter-btn\x20'+(F==='all'?'active':'')+'\x22\x20data-filter=\x22all\x22>Todas</button>',qx['forEach'](qZ=>{qh+='<button\x20class=\x22filter-btn\x20'+(F===qZ?'active':'')+'\x22\x20data-filter=\x22'+qZ+'\x22>'+qZ+'</button>';});}A['line']['innerHTML']=qh,r['line']['innerHTML']=qh;}function Ik(qK,qH){const qm=h('rastreoTable');if(!qm)return;const qh=window['innerWidth']<=0x3e0,qx=qh?0x32:0x1f4;let qZ=qK,qL='';qK['length']>qx&&(qZ=qK['slice'](0x0,qx),qL='<tr\x20class=\x22limit-warning\x22><td\x20colspan=\x22100%\x22\x20style=\x22padding:15px;\x20font-weight:bold;\x20color:var(--warning-color);\x22>‚ö†Ô∏è\x20Se\x20muestran\x20los\x20primeros\x20'+qx+'\x20registros\x20de\x20'+qK['length']+'\x20para\x20optimizar\x20rendimiento.\x20(Usa\x20filtros\x20para\x20ver\x20espec√≠ficos)</td></tr>');const qN=window['innerWidth']<=0x3e0;let qG;const qM=IS(qH,K['SERIAL']);if(qN)qG=[IS(qH,K['SERIAL']),IS(qH,K['LINE']),IS(qH,K['STATION']),IS(qH,K['DATE_REGISTERED'])]['filter'](Boolean);else{const qy=[K['CREATED_BY'],K['NOT_PACKED'],K['IS_SCRAP']]['map'](qT=>IS(qH,qT))['filter'](Boolean);qG=qH?qH['filter'](qT=>!qy['includes'](qT)&&qT!=='status'):[];}if(!qZ||qZ['length']===0x0||!qG||qG['length']===0x0){qm['innerHTML']='<thead><tr><th></th></tr></thead><tbody></tbody>';return;}qm['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20<thead><tr>'+qG['map'](qT=>'<th>'+qT+'</th>')['join']('')+'</tr></thead>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<tbody>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+qZ['map'](qT=>'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tr\x20class=\x22is-'+qT['status']+'\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+qG['map'](qb=>{const qt=qb===qM,qO=qt?'serial-cell':'',qk=qt?'onclick=\x22copySerialNumber(this,\x20\x27'+String(qT[qb])['replace'](/'/g,'\x5c\x27')+'\x27)\x22':'';return'<td\x20class=\x22'+qO+'\x22\x20'+qk+'\x20data-label=\x22'+qb+'\x22>'+q8(qT[qb],qb,qb===IS(qH,K['DATE_REGISTERED']))+'</td>';})['join']('')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20')['join']('')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+qL+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20</tbody>';}function Iv(qK,qH){if(!qH)qH=[];const qm=IS(qH,K['LINE']);if(!qm){lineCountsContainer['innerHTML']='';return;}const qh=qK['reduce']((qx,qZ)=>{const qL=qZ[qm];if(qL)qx[qL]=(qx[qL]||0x0)+0x1;return qx;},{});lineCountsContainer['innerHTML']=Object['entries'](qh)['sort']()['map'](([qx,qZ])=>'<div\x20class=\x22line-badge\x22>'+qx+':\x20<span>'+qZ+'</span></div>')['join']('');}async function Iz(qK,qH,qm){const qh=IS(qm,H['SERIAL']),qx=IS(qm,H['EMPLOYEE_ID']),qZ=IS(qm,H['PACKED_DATE']);let qL='N/A',qN='N/A',qG='N/A';try{const qT=await db['collection']('boxID_historico')['doc'](qK)['get']();if(qT['exists']){const qb=qT['data']();qL=qb['gr']||'N/A',qN=qb['orden']||'N/A',qG=qb['usuario']||'N/A';}}catch(qt){console['error']('Error\x20al\x20obtener\x20datos\x20del\x20BoxID:',qt),qL='Error',qN='Error',qG='Error';}let qM='';if(qH&&qH['length']>0x0){const qO=qH['reduce']((qi,qU)=>qU[qZ]>qi[qZ]?qU:qi,qH[0x0]),qk=qO[qx],qv='<span\x20class=\x22packer-info\x22>GR:\x20<strong\x20class=\x22copyable\x22\x20onclick=\x22copyGR(this,\x20\x27'+qL+'\x27)\x22\x20title=\x22Haz\x20clic\x20para\x20copiar\x22>'+qL+'</strong></span>',qz='<span\x20class=\x22packer-info\x22>Orden:\x20<strong\x20class=\x22copyable\x22\x20onclick=\x22copyGR(this,\x20\x27'+qN+'\x27)\x22\x20title=\x22Haz\x20clic\x20para\x20copiar\x22>'+qN+'</strong></span>',qE='<span\x20class=\x22packer-info\x22>Confirmado\x20por:\x20<strong>'+qG+'</strong></span>';qM='<div\x20class=\x22packing-modal-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22packer-info\x22>EMPACADOR:\x20<strong>'+(qk||'N/A')+'</strong></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+qz+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+qv+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+qE+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>';}let qy=qM+'<ul\x20class=\x22packing-details-list\x22>';qH&&qH['length']>0x0?qH['forEach'](qi=>{qy+='<li>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>'+qi[qh]+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>'+ID(qi[qZ])+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</li>';}):qy+='<li>No\x20hay\x20seriales\x20en\x20esta\x20caja.</li>',qy+='</ul>',Ip('Detalle\x20de\x20Caja:\x20'+qK,qy);}async function IE(qK){const qH=h('empaqueTableContainer');qH['style']['opacity']='0',await new Promise(qv=>setTimeout(qv,0x96));let qm=new Map(),qh=[];if(qK==='all'||qK===null)q['forEach'](qv=>{if(qv['empaqueData'])qv['empaqueData']['forEach']((qz,qE)=>{if(!qm['has'](qE))qm['set'](qE,[]);if(qz&&qz['length']>0x0)qm['get'](qE)['push'](...qz);});});else{if(q['has'](qK)){const qv=q['get'](qK);qm=qv['empaqueData']||new Map(),qh=qv['headers']['empaque']||[];}}if(!qm||qm['size']===0x0){qH['innerHTML']='<table\x20id=\x22empaqueTable\x22><thead><tr><th>No\x20hay\x20datos\x20de\x20empaque.</th></tr></thead></table>',qH['style']['opacity']='1';return;}const qx=Array['from'](qm['keys']());let qZ=new Map(),qL=new Map();if(qx['length']>0x0)try{const qz=qx['map'](qc=>db['collection']('boxID_historico')['doc'](qc)['get']()),qE=await Promise['all'](qz),qi=new Set();qE['forEach'](qc=>{if(qc['exists']){const qs=qc['data']();qZ['set'](qc['id'],qs),qs['gr']&&qs['gr']!=='N/A'&&qi['add'](String(qs['gr'])['trim']());}});const qU=Array['from'](qi);if(qU['length']>0x0){const qc=qU['map'](qX=>db['collection']('gr_historico')['doc'](qX)['get']()),qs=await Promise['all'](qc);qs['forEach'](qX=>{qX['exists']&&qL['set'](qX['id'],qX['data']());});}}catch(qX){console['error']('Error\x20al\x20obtener\x20datos\x20hist√≥ricos\x20puntuales:',qX);}const qN=IS(qh,H['PACKED_DATE']),qG=I1['value']['toLowerCase']();let qM=0x0;const qy=Array['from'](qm['entries']())['reverse'](),qT=[];let qb='';for(const [qg,qJ]of qy){if(!qJ||qJ['length']===0x0)continue;const ql=qJ['some'](Q5=>String(Q5[IS(qh,H['SERIAL'])])['toLowerCase']()['includes'](qG));if(qG&&!String(qg)['toLowerCase']()['includes'](qG)&&!ql)continue;qM++;const qu=qJ['reduce']((Q5,Q6)=>Q6[qN]>Q5[qN]?Q6:Q5,qJ[0x0]),qA=qZ['get'](qg),qr=qA?'boxid-received':'boxid-missing',Q0=qA&&qA['receivedAt']?IU(qA['receivedAt']['toDate']()):'N/A',Q1=qA&&qA['gr']?String(qA['gr'])['trim']():'N/A';Q1!=='N/A'&&qT['push'](Q1);const Q2=qL['get'](Q1),Q3=Q2&&Q2['orden']?Q2['orden']:'N/A',Q4=Q2&&Q2['usuario']?Q2['usuario']:'N/A';qb+='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tr\x20class=\x22box-row\x22\x20data-boxid=\x22'+qg+'\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20data-label=\x22BoxID\x22\x20class=\x22'+qr+'\x22>'+qg+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20data-label=\x22Cantidad\x22>'+qJ['length']+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20data-label=\x22√öltimo\x20Empaque\x22>'+ID(qu[qN])+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20data-label=\x22Recibido\x20Log√≠stica\x22>'+Q0+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20data-label=\x22GR\x22\x20class=\x22copyable\x22\x20onclick=\x22copyGR(this,\x20\x27'+Q1+'\x27)\x22\x20title=\x22Haz\x20clic\x20para\x20copiar\x22>'+Q1+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20data-label=\x22Orden\x22>'+Q3+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20data-label=\x22Usuario\x22>'+Q4+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</tr>';}const qt=qT['join']('\x0a');let qO='<thead><tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<th><span>BoxID</span><input\x20type=\x22text\x22\x20class=\x22filter-input\x22\x20placeholder=\x22Filtrar...\x22\x20data-col-index=\x220\x22></th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<th><span>Cantidad</span><input\x20type=\x22text\x22\x20class=\x22filter-input\x22\x20placeholder=\x22Filtrar...\x22\x20data-col-index=\x221\x22></th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<th><span>√öltimo\x20Empaque</span><input\x20type=\x22text\x22\x20class=\x22filter-input\x22\x20placeholder=\x22Filtrar...\x22\x20data-col-index=\x222\x22></th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<th><span>Recibido\x20Log√≠stica</span><input\x20type=\x22text\x22\x20class=\x22filter-input\x22\x20placeholder=\x22Filtrar...\x22\x20data-col-index=\x223\x22></th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<th\x20class=\x22copyable-header\x22\x20id=\x22header-gr-copy\x22\x20title=\x22Haz\x20clic\x20para\x20copiar\x20toda\x20la\x20columna\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>GR</span><input\x20type=\x22text\x22\x20class=\x22filter-input\x22\x20placeholder=\x22Filtrar...\x22\x20data-col-index=\x224\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<th><span>Orden</span><input\x20type=\x22text\x22\x20class=\x22filter-input\x22\x20placeholder=\x22Filtrar...\x22\x20data-col-index=\x225\x22></th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<th><span>Usuario</span><input\x20type=\x22text\x22\x20class=\x22filter-input\x22\x20placeholder=\x22Filtrar...\x22\x20data-col-index=\x226\x22></th>\x0a\x20\x20\x20\x20</tr></thead>';qM===0x0?qH['innerHTML']='<table\x20id=\x22empaqueTable\x22><thead><tr><th>No\x20se\x20encontraron\x20resultados.</th></tr></thead></table>':qH['innerHTML']='<table\x20id=\x22empaqueTable\x22>'+qO+'<tbody>'+qb+'</tbody></table>';const qk=h('header-gr-copy');qk&&qk['addEventListener']('click',Q5=>{if(Q5['target']['tagName']==='INPUT')return;window['copyColumnData'](Q5['currentTarget'],qt);}),qH['querySelectorAll']('.box-row')['forEach'](Q5=>{Q5['addEventListener']('click',Q6=>{if(Q6['target']['classList']['contains']('copyable'))return;const Q7=Q5['dataset']['boxid'],Q8=qm['get'](Q7);Iz(Q7,Q8,qh);});}),qH['style']['opacity']='1',Ii(qH);}function Ii(qK){qK['querySelectorAll']('.filter-input')['forEach'](qH=>{qH['addEventListener']('click',qm=>qm['stopPropagation']()),qH['closest']('.copyable-header')&&qH['addEventListener']('click',qm=>qm['preventDefault']()),qH['addEventListener']('keyup',()=>{const qm=h('empaqueTable'),qh=Array['from'](qm['querySelectorAll']('thead\x20.filter-input')),qx=qm['querySelectorAll']('tbody\x20tr');qx['forEach'](qZ=>{let qL=!![];qh['forEach'](qN=>{const qG=qN['value']['toLowerCase'](),qM=parseInt(qN['dataset']['colIndex'],0xa);if(qG){const qy=qZ['cells'][qM],qT=qy?qy['textContent']['toLowerCase']():'';if(!qT['includes'](qG))qL=![];}}),qZ['style']['display']=qL?'':'none';});});});}window['copyColumnData']=function(qK,qH){if(!qH)return;IY(qH,()=>{const qm=qK['textContent'];qK['textContent']='¬°COPIADO!',qK['style']['color']='var(--success-color)',setTimeout(()=>{qK['textContent']=qm,qK['style']['color']='';},0x7d0);},qm=>{console['error']('Error\x20al\x20copiar\x20la\x20columna:\x20',qm);const qh=qK['textContent'];qK['textContent']='ERROR',qK['style']['color']='var(--danger-color)',setTimeout(()=>{qK['textContent']=qh,qK['style']['color']='';},0x7d0);});};function IU(qK){if(!(qK instanceof Date)||isNaN(qK))return'';const qH=qK['getFullYear']()['toString']()['slice'](-0x2),qm=String(qK['getMonth']()+0x1)['padStart'](0x2,'0'),qh=String(qK['getDate']())['padStart'](0x2,'0'),qx=String(qK['getHours']())['padStart'](0x2,'0'),qZ=String(qK['getMinutes']())['padStart'](0x2,'0');return qh+'/'+qm+'/'+qH+'\x20'+qx+':'+qZ;}window['copyGR']=function(qK,qH){if(!qH||qH==='N/A')return;IY(qH,()=>{const qm=qK['textContent'];qK['textContent']='¬°Copiado!',qK['style']['color']='var(--success-color)',setTimeout(()=>{qK['textContent']=qm,qK['style']['color']='';},0x5dc);},qm=>{console['error']('Error\x20al\x20copiar\x20el\x20GR:\x20',qm);});};async function Ic(qK){if(!e||e['length']===0x0){Ip('Exportar\x20Captura','No\x20hay\x20datos\x20en\x20la\x20vista\x20actual\x20para\x20exportar.','warning');return;}const qH=qK['target']['closest']('button'),qm=qH['textContent'];qH['textContent']='Generando...',qH['disabled']=!![];const qh=document['createElement']('div');qh['style']['position']='absolute',qh['style']['left']='-9999px',qh['style']['top']='0',qh['style']['display']='inline-block',qh['style']['background']='var(--surface-color)',qh['style']['padding']='20px',qh['style']['borderRadius']='16px';const qx=h('rastreoTable'),qZ=qx['cloneNode'](!![]);if(o&&o!=='all'){const qN=qZ['createCaption']();qN['textContent']=o;}const qL=document['createElement']('style');qL['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20:root\x20{\x20--surface-color:\x20#1E293B;\x20--border-color:\x20#334155;\x20--danger-color:\x20#FB7185;\x20--warning-color:\x20#FBBF24;\x20--orange-color:\x20#F97316;\x20--success-color:\x20#34D399;\x20--text-primary:\x20#F8FAFC;\x20--text-secondary:\x20#94A3B8;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20table\x20{\x20color:\x20var(--text-primary);\x20background-color:\x20var(--surface-color);\x20border-collapse:\x20collapse;\x20font-family:\x20\x27Inter\x27,\x20sans-serif;\x20font-size:\x2014px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20caption\x20{\x20caption-side:\x20top;\x20text-align:\x20center;\x20font-size:\x2024px;\x20font-weight:\x20700;\x20color:\x20var(--text-secondary);\x20margin-bottom:\x2020px;\x20font-family:\x20\x27Inter\x27,\x20sans-serif;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20th,\x20td\x20{\x20padding:\x2012px\x2024px;\x20text-align:\x20center\x20!important;\x20border:\x201px\x20solid\x20var(--border-color);\x20white-space:\x20nowrap;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20thead\x20{\x20display:\x20table-header-group\x20!important;\x20background-color:\x20#1a2436;\x20position:\x20static\x20!important;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20th\x20{\x20font-weight:\x20600;\x20color:\x20var(--text-secondary);\x20font-size:\x2012px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20tr\x20{\x20display:\x20table-row\x20!important;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20td\x20{\x20display:\x20table-cell\x20!important;\x20background-color:\x20inherit\x20!important;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20td::before\x20{\x20display:\x20none\x20!important;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20tr.is-scrap\x20{\x20background-color:\x20rgba(251,\x20113,\x20133,\x200.1)\x20!important;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20tr.is-scrap\x20td\x20{\x20color:\x20var(--danger-color)\x20!important;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20tr.is-very_delayed\x20{\x20background-color:\x20rgba(249,\x20115,\x2022,\x200.1)\x20!important;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20tr.is-very_delayed\x20td\x20{\x20color:\x20var(--orange-color)\x20!important;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20tr.is-delayed\x20{\x20background-color:\x20rgba(251,\x20191,\x2036,\x200.1)\x20!important;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20tr.is-delayed\x20td\x20{\x20color:\x20var(--warning-color)\x20!important;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20tr.is-today\x20{\x20background-color:\x20rgba(52,\x20211,\x20153,\x200.1)\x20!important;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20tr.is-today\x20td\x20{\x20color:\x20var(--success-color)\x20!important;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',qh['appendChild'](qL),qh['appendChild'](qZ),document['body']['appendChild'](qh),await new Promise(qG=>setTimeout(qG,0x64));try{const qG=await html2canvas(qh,{'scale':0x2,'useCORS':!![],'backgroundColor':null}),qM=document['createElement']('a');qM['href']=qG['toDataURL']('image/jpeg',0.95);const qy=o&&o!=='all'?o:'Multiples_Ordenes',qT=new Date()['toLocaleDateString']('es-ES')['replace'](/\//g,'-');qM['download']='Captura_Rastreo_'+qy+'_'+qT+'.jpg',document['body']['appendChild'](qM),qM['click'](),document['body']['removeChild'](qM);}catch(qb){console['error']('Error\x20al\x20generar\x20la\x20imagen:',qb),Ip('Error','Ocurri√≥\x20un\x20error\x20al\x20generar\x20el\x20archivo\x20de\x20imagen.','error');}finally{document['body']['removeChild'](qh),qH['textContent']=qm,qH['disabled']=![];}}function Is(){const qK=Array['from'](q['entries']())['filter'](([qm,qh])=>qh['orderQty']>qh['packedQty']&&(qh['rastreoData']&&qh['rastreoData']['length']>0x0))['map'](([qm,qh])=>({'key':qm,...qh}));if(qK['length']===0x0){Ip('Reporte\x20de\x20Estatus','‚úÖ\x20No\x20hay\x20√≥rdenes\x20incompletas\x20con\x20seriales\x20cargados\x20en\x20el\x20√°rea\x20'+D+'.','success');return;}let qH='<div\x20class=\x22status-report\x22>';qH+='<p><strong>Fecha\x20del\x20Reporte:</strong>\x20'+new Date()['toLocaleString']('es-ES',{'dateStyle':'full','timeStyle':'short'})+'</p>',qK['forEach'](qm=>{const qh=new Set();qm['empaqueData']&&qm['empaqueData']['forEach'](qT=>{qT['forEach'](qb=>{const qt=IS(Object['keys'](qb),H['SERIAL']);if(qt)qh['add'](qb[qt]);});});const qx=IS(qm['headers']['rastreo'],K['SERIAL']),qZ=IS(qm['headers']['rastreo'],K['STATION']),qL=qx?qm['rastreoData']['filter'](qT=>!qh['has'](qT[qx])&&qT['status']!=='scrap'):[],qN=qL['filter'](qT=>qT['status']==='delayed'||qT['status']==='very_delayed'),qG=qL['filter'](qT=>qT['status']==='today'),qM=qm['orderQty']>0x0?qm['packedQty']/qm['orderQty']*0x64:0x0;let qy='var(--success-color)';if(qM<0x1e)qy='var(--danger-color)';else{if(qM<0x46)qy='var(--warning-color)';}qH+='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h4>üì¶\x20Orden:\x20'+qm['key']+'\x20('+(qm['packedQty']||0x0)+'/'+(qm['orderQty']||0x0)+')</h4>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22order-progress-bar\x22\x20style=\x22height:\x208px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22order-progress-bar-inner\x22\x20style=\x22width:\x20'+Math['min'](qM,0x64)+'%;\x20background-color:\x20'+qy+';\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',qN['length']>0x0&&(qH+='<p\x20style=\x22margin-top:\x2015px;\x22><strong>‚ö†Ô∏è\x20Sin\x20Movimiento\x20('+qN['length']+'):</strong></p><ul>',qN['forEach'](qT=>{qH+='<li>'+qT[qx]+'\x20-\x20(Estaci√≥n:\x20'+(qT[qZ]||'N/A')+')</li>';}),qH+='</ul>'),qG['length']>0x0&&(qH+='<p><strong>‚úÖ\x20En\x20Proceso\x20('+qG['length']+'):</strong></p><ul>',qG['forEach'](qT=>{qH+='<li>'+qT[qx]+'\x20-\x20(Estaci√≥n:\x20'+(qT[qZ]||'N/A')+')</li>';}),qH+='</ul>'),qL['length']===0x0&&(qH+='<p\x20style=\x22margin-top:\x2015px;\x22>No\x20hay\x20seriales\x20pendientes\x20de\x20empacar\x20para\x20esta\x20orden.</p>');}),qH+='</div>',Ip('Reporte\x20de\x20Estatus:\x20'+D,qH,'info',!![]);}async function IX(qK,qH){try{const qm={'orders':qK,'lastUpdated':new Date(),'lastUpdatedBy':a['user']};await db['collection']('areas')['doc'](qH)['collection']('sap_data')['doc']('current_data')['set'](qm);}catch(qh){console['error']('Error\x20al\x20guardar\x20datos\x20SAP\x20en\x20Firebase\x20para\x20'+qH+':\x20',qh),Ip('Error','No\x20se\x20pudieron\x20guardar\x20los\x20datos\x20de\x20SAP\x20en\x20la\x20nube\x20para\x20'+qH+'.','error');}}async function Ig(qK){if(!qK)return;const qH=a['isMaster']||a['permissions']&&a['permissions']['includes'](D);if(!qH){Ip('Acceso\x20Denegado','No\x20tienes\x20permisos\x20para\x20modificar\x20el\x20√°rea\x20'+D+'.','error');return;}try{const qm=db['collection']('areas')['doc'](D)['collection']('sap_historico')['doc'](qK);await qm['delete'](),console['log']('Orden\x20'+qK+'\x20eliminada\x20de\x20\x27sap_historico\x27.');}catch(qh){console['error']('Error\x20al\x20eliminar\x20la\x20orden\x20SAP\x20de\x20Firebase:\x20',qh),Ip('Error\x20al\x20Eliminar','No\x20se\x20pudo\x20eliminar\x20la\x20orden\x20'+qK+'\x20del\x20hist√≥rico\x20de\x20SAP.','error');}}function IJ(){const qK=h('sapBulkDeleteBtn');if(qK){const qH=W['size'];qH>0x0?(qK['textContent']='Eliminar\x20('+qH+')',qK['style']['display']='inline-block'):qK['style']['display']='none';}}async function Il(qK){if(!qK||qK['length']===0x0)return;const qH=a['isMaster']||a['permissions']&&a['permissions']['includes'](D);if(!qH){Ip('Acceso\x20Denegado','No\x20tienes\x20permisos\x20para\x20modificar\x20el\x20√°rea\x20'+D+'.','error');return;}const qm=db['batch'](),qh=db['collection']('areas')['doc'](D)['collection']('sap_historico');qK['forEach'](qx=>{const qZ=qh['doc'](qx);qm['delete'](qZ);});try{await qm['commit'](),console['log'](qK['length']+'\x20√≥rdenes\x20eliminadas\x20de\x20\x27sap_historico\x27.'),W['clear'](),IJ();}catch(qx){console['error']('Error\x20en\x20el\x20borrado\x20m√∫ltiple\x20de\x20SAP:\x20',qx),Ip('Error\x20al\x20Eliminar','No\x20se\x20pudieron\x20eliminar\x20las\x20√≥rdenes\x20seleccionadas\x20del\x20hist√≥rico\x20de\x20SAP.','error');}}async function Iu(qK){const qH=Object['values'](qK)['reduce']((qx,qZ)=>qx+qZ['length'],0x0),qm=Object['keys'](qK);Ip('Procesando...','Sincronizando\x20'+qH+'\x20√≥rdenes\x20en\x20'+qm['length']+'\x20√°reas...','info');const qh=[];for(const qx in qK){if(Object['hasOwnProperty']['call'](qK,qx)){const qZ=qK[qx];qh['push'](IX(qZ,qx)),qh['push'](q0(qZ,qx)),j[qx]=!![];}}await Promise['all'](qh),IF(),Ip('√âxito','Workshop\x20general\x20procesado.\x20Se\x20han\x20sincronizado\x20los\x20datos\x20para\x20las\x20√°reas:\x20'+qm['join'](',\x20')+'.','success');}async function IA(qK){if(!qK)return;const qH=a['isMaster']||a['permissions']&&a['permissions']['includes'](D);if(!qH){Ip('Acceso\x20Denegado','No\x20tienes\x20permisos\x20para\x20modificar\x20el\x20√°rea\x20'+D+'.','error');return;}Ip('Procesando\x20SAP...','<p>Leyendo\x20el\x20archivo\x20y\x20preparando\x20para\x20guardar\x20en\x20el\x20hist√≥rico.\x20Por\x20favor,\x20espere...</p>');const qm=new FileReader();qm['onload']=async qh=>{try{const qx=XLSX['read'](new Uint8Array(qh['target']['result']),{'type':'array'}),qZ=q1(qx,a['isMaster']);if(a['isMaster']&&qZ['isMultiArea']){const qL=Object['keys'](qZ['data']);Ip('Procesando\x20M√∫ltiples\x20√Åreas...','Sincronizando\x20√≥rdenes\x20en\x20'+qL['length']+'\x20√°reas...');const qN=[];for(const qG in qZ['data']){const qM=qZ['data'][qG];qN['push'](Ir(qM,qG)),qN['push'](q0(qM,qG));}await Promise['all'](qN),Ip('√âxito','Workshop\x20general\x20procesado.\x20Se\x20han\x20sincronizado\x20los\x20datos\x20para\x20las\x20√°reas:\x20'+qL['join'](',\x20')+'.','success');}else{const qy=qZ['isMultiArea']?qZ['data'][D]||[]:qZ;if(qy['length']===0x0){Ip('Sin\x20Datos','El\x20archivo\x20no\x20contiene\x20√≥rdenes\x20v√°lidas\x20para\x20el\x20√°rea\x20actual.','warning');return;}await Ir(qy,D),await q0(qy,D),Ip('√âxito','Archivo\x20SAP\x20cargado.\x20Se\x20han\x20creado/actualizado\x20'+qy['length']+'\x20√≥rdenes\x20en\x20el\x20hist√≥rico\x20del\x20√°rea\x20'+D+'.','success');}w=[];}catch(qT){console['error']('Error\x20procesando\x20archivo\x20SAP:',qT),Ip('Error','No\x20se\x20pudo\x20procesar\x20el\x20archivo\x20SAP.\x20<br><small>'+qT['message']+'</small>','error');}},qm['readAsArrayBuffer'](qK);}async function Ir(qK,qH){if(!qH||qK['length']===0x0)return;const qm=db['batch'](),qh=db['collection']('areas')['doc'](qH)['collection']('sap_historico');for(const qx of qK){const qZ=String(qx['Orden']),qL=qh['doc'](qZ),qN={...qx,'lastUpdated':new Date(),'lastUpdatedBy':a['user']};qm['set'](qL,qN,{'merge':!![]});}try{await qm['commit'](),console['log'](qK['length']+'\x20√≥rdenes\x20de\x20SAP\x20guardadas\x20en\x20el\x20hist√≥rico\x20del\x20√°rea\x20'+qH+'.');}catch(qG){console['error']('Error\x20al\x20guardar\x20en\x20el\x20hist√≥rico\x20de\x20SAP\x20para\x20'+qH+':',qG),Ip('Error\x20de\x20Guardado','No\x20se\x20pudo\x20actualizar\x20el\x20hist√≥rico\x20de\x20SAP\x20para\x20'+qH+'.','error');}}async function q0(qK,qH){if(!qH||qK['length']===0x0)return;const qm=[];for(let qx=0x0;qx<qK['length'];qx+=0x1f4){qm['push'](qK['slice'](qx,qx+0x1f4));}let qh=0x0;for(const qZ of qm){const qL=db['batch'](),qN=db['collection']('areas')['doc'](qH)['collection']('orders');qZ['forEach'](qG=>{const qM=String(qG['Orden']),qy=qN['doc'](qM),qT={'orderQty':qG['Total\x20orden']||0x0,'catalogNumber':qG['Catalogo']||'N/A','orderDate':Ia(qG['Finish'])||new Date(),'lastUpdated':new Date(),'lastUpdatedBy':a['user']};qL['set'](qy,qT,{'merge':!![]});});try{await qL['commit'](),qh+=qZ['length'];}catch(qG){console['error']('Error\x20lote\x20sincronizaci√≥n\x20SAP\x20'+qH+':',qG);}}console['log']('‚úÖ\x20Sincronizaci√≥n\x20SAP\x20completada.\x20'+qh+'\x20√≥rdenes\x20actualizadas\x20en\x20FWD\x20sin\x20lecturas\x20masivas.');}function q1(qK,qH=![]){const qm=qK['Sheets'][qK['SheetNames'][0x0]];if(!qm)throw new Error('No\x20se\x20encontr√≥\x20una\x20hoja\x20de\x20c√°lculo\x20en\x20el\x20archivo.');const qh=qL=>qm[qL]?qm[qL]['v']:null,qx=XLSX['utils']['decode_range'](qm['!ref']),qZ=new Date()['toLocaleDateString']('en-CA',{'timeZone':m});if(qH){const qL={};for(let qN=qx['s']['r']+0x1;qN<=qx['e']['r'];qN++){const qG=qN+0x1,qM=qh('A'+qG);if(!qM)continue;const qy=String(qM)['trim']();if(!qy['startsWith']('900'))continue;const qT=qh(I['column']+qG),qb=I['mapping'][qT];if(qb){!qL[qb]&&(qL[qb]=[]);const qt=q2(qm,qG,qZ);qL[qb]['push'](qt);}}return{'isMultiArea':!![],'data':qL};}else{const qO=[];for(let qk=qx['s']['r']+0x1;qk<=qx['e']['r'];qk++){const qv=qk+0x1,qz=qh('A'+qv);if(!qz)continue;const qE=String(qz)['trim']();if(!qE['startsWith']('900'))continue;qO['push'](q2(qm,qv,qZ));}return qO;}}function q2(qK,qH,qm){const qh=qt=>qK[qt]?qK[qt]['v']:null,qx=parseFloat(qh('I'+qH))||0x0,qZ=parseFloat(qh('J'+qH))||0x0,qL=qx-qZ,qN=qh('B'+qH)||'',qG=qh('L'+qH)||'';let qM='incomplete';const qy=qh('G'+qH),qT=Ia(qy),qb=qT?qT['toLocaleDateString']('en-CA',{'timeZone':m}):'';if(qL<=0x0)qM='complete';else qb&&qb<qm&&(qM='late');return{'Orden':qh('A'+qH),'Catalogo':qh('D'+qH)||null,'Material':qh('C'+qH)||null,'Special\x20Stock':[qN,qG]['filter'](Boolean)['join']('\x20/\x20')||null,'Finish':qy,'Total\x20orden':qx,'Total\x20confirmado':qZ,'Faltante':qL,'status':qM};}function q3(){const qK=a['isMaster']||a['permissions']&&a['permissions']['includes'](D);I2['classList']['toggle']('disabled',!qK);I2['querySelector']('p')&&(I2['querySelector']('p')['textContent']=qK?a['isMaster']?'Arrastra\x20un\x20archivo\x20maestro\x20SAP\x20(General\x20o\x20de\x20√Årea)':'Arrastra\x20un\x20archivo\x20maestro\x20SAP\x20(.xlsx)':'No\x20tienes\x20permisos\x20para\x20esta\x20√°rea');const qH=n['length']>0x0;I4['style']['display']=qH?'none':'block',II['disabled']=!qH,q5(),q6(),q7(),I8['style']['display']=w['length']>0x0&&qH?'inline-block':'none';if(B){let qm='√öltima\x20actualizaci√≥n:\x20'+IC(B);P&&(qm+='\x20por:\x20'+P),I9['textContent']=qm;}else I9['textContent']='';}function q4(qK){const qH=new Date()['toLocaleDateString']('es-ES',{'timeZone':m,'day':'2-digit','month':'2-digit','year':'numeric'}),qm=Ia(qK['Finish']);return qm&&IV(qm)===qH;}function q5(){if(n['length']===0x0){I6['textContent']='0',I7['textContent']='0';return;}const qK=n['filter'](qm=>q4(qm))['length'],qH=n['filter'](qm=>qm['status']==='complete'&&q4(qm))['length'];I6['textContent']=qK,I7['textContent']=qH;}function q6(){if(n['length']===0x0){I5['innerHTML']='<p\x20class=\x22text-dark\x22\x20style=\x22font-size:0.9rem;\x22>Cargue\x20un\x20archivo\x20para\x20ver\x20las\x20√≥rdenes.</p>';return;}!Array['isArray'](w)&&(w=w==='default'?[]:[w]);const qK=new Map();n['forEach'](qx=>{const qZ=Ia(qx['Finish'])||new Date(0x0),qL=IV(qZ);if(!qK['has'](qL))qK['set'](qL,0x0);qK['set'](qL,qK['get'](qL)+0x1);});const qH=Array['from'](qK['keys']())['sort']((qx,qZ)=>{const qL=new Date(qx['split']('/')['reverse']()['join']('-')),qN=new Date(qZ['split']('/')['reverse']()['join']('-'));return qN-qL;}),qm=new Date()['toLocaleDateString']('es-ES',{'timeZone':m,'day':'2-digit','month':'2-digit','year':'numeric'});let qh='';qH['forEach'](qx=>{const qZ=qK['get'](qx),qL=qx===qm,qN=qZ+'\x20'+(qZ===0x1?'orden':'√≥rdenes');qh+='<div\x20class=\x22order-item\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22date-header\x22\x20data-date=\x22'+qx+'\x22\x20style=\x22width:100%;\x20justify-content:\x20space-between;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>üìÖ\x20'+qx+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(qL?'<span\x20class=\x22status-indicator\x22>('+qN+')</span>':'<span\x20class=\x22order-count\x22>('+qN+')</span>')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>';}),I5['innerHTML']=qh,I5['querySelectorAll']('.date-header')['forEach'](qx=>{w['includes'](qx['dataset']['date'])&&qx['classList']['add']('active'),qx['addEventListener']('click',()=>{const qZ=qx['dataset']['date'],qL=w['indexOf'](qZ);qL>-0x1?w['splice'](qL,0x1):w['push'](qZ),q3();});});}function q7(){const qK=h('sapTable');if(n['length']===0x0){qK['innerHTML']='',W['clear'](),IJ();return;}let qH=[];w['length']===0x0?qH=n['filter'](qG=>qG['status']==='late'||q4(qG)):qH=n['filter'](qG=>{const qM=IV(Ia(qG['Finish']));return w['includes'](qM);});if(qH['length']===0x0){qK['innerHTML']='<thead><tr><th>No\x20hay\x20√≥rdenes\x20para\x20la\x20selecci√≥n\x20actual.</th></tr></thead>',IJ();return;}const qm=a['isMaster']||a['permissions']&&a['permissions']['includes'](D),qh=['Orden','Catalogo','Material','Special\x20Stock','Finish','Total\x20orden','Total\x20confirmado','Faltante'],qx=qH['map'](qG=>String(qG['Orden']))['join']('\x0a');let qZ='';qm&&(qZ+='<th><input\x20type=\x22checkbox\x22\x20id=\x22sap-select-all-checkbox\x22\x20title=\x22Seleccionar\x20Todo\x22></th>');qZ+='<th\x20class=\x22copyable-header\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id=\x22sap-copy-order-header\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20title=\x22Clic\x20para\x20copiar\x20TODA\x20la\x20columna\x20\x27Orden\x27\x22>Orden</th>',qh['slice'](0x1)['forEach'](qG=>{qZ+='<th>'+qG['replace'](/_/g,'\x20')+'</th>';});qm&&(qh['push']('Acciones'),qZ+='<th>Acciones</th>');qK['innerHTML']='\x0a\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20<thead><tr>'+qZ+'</tr></thead>\x0a\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20<tbody>\x0a\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20'+qH['map'](qG=>{const qM=String(qG['Orden']),qy=W['has'](qM);let qT='',qb='';return qm&&(qb='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20style=\x22text-align:\x20center;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22checkbox\x22\x20class=\x22sap-select-row-checkbox\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20data-order-key=\x22'+qM+'\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(qy?'checked':'')+'>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</td>',qT='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20data-label=\x22Acciones\x22\x20style=\x22text-align:\x20center;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22icon-btn\x20sap-delete-btn\x22\x20title=\x22Eliminar\x20orden\x20SAP\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20data-order-key=\x22'+qM+'\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20style=\x22font-size:\x201rem;\x20filter:\x20grayscale(0)\x20opacity(0.6);\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20xmlns=\x22http://www.w3.org/2000/svg\x22\x20width=\x2218\x22\x20height=\x2218\x22\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22><polyline\x20points=\x223\x206\x205\x206\x2021\x206\x22></polyline><path\x20d=\x22M19\x206v14a2\x202\x200\x200\x201-2\x202H7a2\x202\x200\x200\x201-2-2V6m3\x200V4a2\x202\x200\x200\x201\x202-2h4a2\x202\x200\x200\x201\x202\x202v2\x22></path></svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</td>'),'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tr\x20class=\x22is-'+qG['status']+'-sap\x20'+(qy?'is-selected-row':'')+'\x22>\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+qb+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20data-label=\x22Orden\x22\x20class=\x22serial-cell\x20sap-copy-cell\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20title=\x22Clic\x20para\x20copiar\x20orden\x20'+qM+'\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20data-order-key=\x22'+qM+'\x22>'+qM+'</td>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20data-label=\x22Catalogo\x22>'+qG['Catalogo']+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20data-label=\x22Material\x22>'+qG['Material']+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20data-label=\x22Special\x20Stock\x22>'+qG['Special\x20Stock']+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20data-label=\x22Finish\x22>'+IV(Ia(qG['Finish']))+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20data-label=\x22Total\x20orden\x22>'+qG['Total\x20orden']+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20data-label=\x22Total\x20confirmado\x22>'+qG['Total\x20confirmado']+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20data-label=\x22Faltante\x22>'+qG['Faltante']+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+qT+'\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';})['join']('')+'\x0a\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20</tbody>',qK['querySelectorAll']('.sap-delete-btn')['forEach'](qG=>{qG['addEventListener']('click',qM=>{const qy=qM['currentTarget']['dataset']['orderKey'];IR('¬øSeguro\x20que\x20quieres\x20eliminar\x20la\x20orden\x20SAP\x20'+qy+'?\x20Esto\x20la\x20borrar√°\x20S√ìLO\x20del\x20hist√≥rico\x20de\x20SAP\x20(No\x20afectar√°\x20la\x20vista\x20FWD).',()=>Ig(qy));});}),qK['querySelectorAll']('.sap-copy-cell')['forEach'](qG=>{qG['addEventListener']('click',qM=>{qM['stopPropagation']();const qy=qM['currentTarget']['dataset']['orderKey'];copySerialNumber(qM['currentTarget'],qy);});});const qL=h('sap-copy-order-header');qL&&qL['addEventListener']('click',qG=>{window['copyColumnData'](qG['currentTarget'],qx);});const qN=h('sap-select-all-checkbox');qN&&qN['addEventListener']('click',qG=>{const qM=qG['currentTarget']['checked'],qy=qK['querySelectorAll']('.sap-select-row-checkbox');qy['forEach'](qT=>{const qb=qT['dataset']['orderKey'];qT['checked']=qM,qM?W['add'](qb):W['delete'](qb),qT['closest']('tr')['classList']['toggle']('is-selected-row',qM);}),IJ();}),qK['querySelectorAll']('.sap-select-row-checkbox')['forEach'](qG=>{qG['addEventListener']('click',qM=>{qM['stopPropagation']();const qy=qM['currentTarget']['dataset']['orderKey'],qT=qM['currentTarget']['checked'];qT?W['add'](qy):W['delete'](qy);qM['currentTarget']['closest']('tr')['classList']['toggle']('is-selected-row',qT),IJ();if(qN){const qb=qK['querySelectorAll']('.sap-select-row-checkbox'),qt=Array['from'](qb)['every'](qO=>qO['checked']);qN['checked']=qt;}});}),IJ();}function q8(qK,qH,qm=![]){if(qm)return ID(qK);if(qH&&qH['toLowerCase']()['includes']('date'))return IV(Ia(qK));return qK===undefined||qK===null?'':qK;}function q9(){if(q['size']===0x0||n['length']===0x0)return;const qK=new Map(n['map'](qH=>[String(qH['Orden']),qH['Finish']]));q['forEach']((qH,qm)=>{if(qK['has'](qm)){const qh=qK['get'](qm),qx=Ia(qh);qx&&(qH['orderDate']=qx);}});}function qI(){let qK='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>Introduce\x20tus\x20credenciales\x20para\x20acceder.</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20id=\x22userInput\x22\x20placeholder=\x22Usuario\x22\x20style=\x22text-transform:uppercase\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22password\x22\x20id=\x22passwordInput\x22\x20placeholder=\x22Contrase√±a\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22loginBtn\x22\x20class=\x22btn\x22\x20style=\x22margin-top:\x2016px;\x22>Autenticar</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';Ip('Inicio\x20de\x20Sesi√≥n',qK),h('loginBtn')['addEventListener']('click',qq),h('passwordInput')['addEventListener']('keyup',qH=>{if(qH['key']==='Enter')qq();}),h('userInput')['addEventListener']('keyup',qH=>{if(qH['key']==='Enter')qq();});}async function qq(){const qK=h('userInput')['value']['trim']()['toUpperCase'](),qH=h('passwordInput')['value'];if(!qK||!qH){Ip('Error','Debes\x20ingresar\x20el\x20usuario\x20y\x20la\x20contrase√±a.','error');return;}try{const qm=await db['collection']('users')['doc'](qK)['get']();if(!qm['exists']){Ip('Error','El\x20usuario\x20no\x20existe.','error');return;}const qh=qm['data']();qh['password']===qH?(a={'user':qh['username'],'isMaster':qh['isMaster']||![],'permissions':qh['permissions']||[]},sessionStorage['setItem']('appSession',JSON['stringify'](a)),IF(),qf()):Ip('Error','Contrase√±a\x20incorrecta.','error');}catch(qx){console['error']('Error\x20de\x20autenticaci√≥n:\x20',qx),Ip('Error','Ocurri√≥\x20un\x20error\x20al\x20verificar\x20las\x20credenciales.','error');}}function qQ(){a={'user':null,'isMaster':![],'permissions':[]},sessionStorage['removeItem']('appSession'),qf();}function qf(){const qK=!!a['user'],qH=qK&&(a['isMaster']||a['permissions']&&a['permissions']['includes'](D));Z['classList']['toggle']('disabled',!qH),Z['querySelector']('p')['textContent']=qH?'Arrastra\x20archivos\x20de\x20detalle\x20(.xlsx)':'No\x20tienes\x20permisos\x20para\x20esta\x20√°rea',I2['classList']['toggle']('disabled',!qH),I2['querySelector']('p')&&(I2['querySelector']('p')['textContent']=qH?a['isMaster']?'Arrastra\x20un\x20archivo\x20maestro\x20SAP\x20(General\x20o\x20de\x20√Årea)':'Arrastra\x20un\x20archivo\x20maestro\x20SAP\x20(.xlsx)':'No\x20tienes\x20permisos\x20para\x20esta\x20√°rea'),qK?(X['style']['display']='flex',a['isMaster']?(c['style']['display']='flex',c['innerHTML']='<svg\x20xmlns=\x22http://www.w3.org/2000/svg\x22\x20width=\x2220\x22\x20height=\x2220\x22\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22><path\x20d=\x22M14.7\x206.3a1\x201\x200\x200\x200\x200\x201.4l1.6\x201.6a1\x201\x200\x200\x200\x201.4\x200l3.77-3.77a6\x206\x200\x200\x201-7.94\x207.94l-6.91\x206.91a2.12\x202.12\x200\x200\x201-3-3l6.91-6.91a6\x206\x200\x200\x201\x207.94-7.94l-3.76\x203.76z\x22></path></svg>\x20'+a['user']):c['style']['display']='none'):(X['style']['display']='none',c['style']['display']='flex',c['innerHTML']='<svg\x20xmlns=\x22http://www.w3.org/2000/svg\x22\x20width=\x2220\x22\x20height=\x2220\x22\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22><path\x20d=\x22M14.7\x206.3a1\x201\x200\x200\x200\x200\x201.4l1.6\x201.6a1\x201\x200\x200\x200\x201.4\x200l3.77-3.77a6\x206\x200\x200\x201-7.94\x207.94l-6.91\x206.91a2.12\x202.12\x200\x200\x201-3-3l6.91-6.91a6\x206\x200\x200\x201\x207.94-7.94l-3.76\x203.76z\x22></path></svg>'),l['style']['display']=a['isMaster']?'flex':'none',U['textContent']='√Årea:\x20'+D,IL(),IM();}async function qn(){const qK=await getCachedAreas();let qH=qK['map'](qh=>({'id':qh,'name':qh})),qm='<h3>Selecciona\x20un\x20√Årea\x20para\x20Visualizar</h3><ul\x20class=\x22area-list\x22\x20style=\x22grid-template-columns:\x201fr\x20auto;\x22>';qH['forEach'](qh=>{qm+='<li><span>'+qh['name']+'</span>\x20<button\x20class=\x22btn\x20select-area-btn\x22\x20data-area=\x22'+qh['id']+'\x22\x20style=\x22width:\x20auto;\x20padding:\x205px\x2010px;\x22>Seleccionar</button></li>';}),qm+='</ul>',Ip('Selector\x20de\x20√Årea',qm),h('modalBody')['querySelectorAll']('.select-area-btn')['forEach'](qh=>{qh['addEventListener']('click',qx=>{const qZ=qx['target']['dataset']['area'];qZ!==D&&(D=qZ,localStorage['setItem']('currentArea',D),U['textContent']='√Årea:\x20'+D,qa(D)),qf(),IF();});});}async function qB(){const [qK,qH]=await Promise['all']([db['collection']('areas')['get'](),db['collection']('users')['get']()]);let qm=[];qK['forEach'](qL=>{if(qL['id']!=='CONFIG')qm['push']({'id':qL['id'],...qL['data']()});}),qm['sort']((qL,qN)=>qL['id']['localeCompare'](qN['id']));let qh=[];qH['forEach'](qL=>qh['push']({'id':qL['id'],...qL['data']()})),qh['sort']((qL,qN)=>qL['id']['localeCompare'](qN['id']));let qx='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22admin-section\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22admin-section-header\x22>Gestionar\x20Usuarios</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22admin-section-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<ul\x20class=\x22area-list\x20user-list\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+qh['map'](qL=>'<li>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20style=\x22font-weight:\x20bold;\x22>'+qL['username']+'\x20'+(qL['isMaster']?'\x20(Admin)':'')+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22permissions-display\x22>'+(qL['permissions']||[])['join'](',\x20')+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(qL['username']!=='MULTIPORT'?'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x20edit-user-btn\x22\x20data-id=\x22'+qL['id']+'\x22\x20style=\x22width:\x20auto;\x20padding:\x205px\x2010px;\x22>Editar</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x20btn-danger\x20delete-user-btn\x22\x20data-id=\x22'+qL['id']+'\x22\x20style=\x22width:\x20auto;\x20padding:\x205px\x2010px;\x20margin-left:\x205px;\x22>Eliminar</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20':'')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</li>')['join']('')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</ul>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22createUserBtn\x22\x20class=\x22btn\x22\x20style=\x22margin-top:\x2020px;\x22>Crear\x20Nuevo\x20Usuario</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22admin-section\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22admin-section-header\x22>Gestionar\x20√Åreas\x20y\x20Contrase√±as</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22admin-section-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<ul\x20class=\x22area-list\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+qm['map'](qL=>'<li>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20class=\x22area-name-input\x22\x20data-id=\x22'+qL['id']+'\x22\x20value=\x22'+qL['name']+'\x22\x20disabled>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20class=\x22area-password-input\x22\x20data-id=\x22'+qL['id']+'\x22\x20value=\x22'+(qL['password']||'')+'\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x20save-area-btn\x22\x20data-id=\x22'+qL['id']+'\x22\x20style=\x22width:\x20auto;\x20padding:\x205px\x2010px;\x22>Guardar</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(!qL['isMaster']?'<button\x20class=\x22btn\x20btn-danger\x20delete-area-btn\x22\x20data-id=\x22'+qL['id']+'\x22\x20style=\x22width:\x20auto;\x20padding:\x205px\x2010px;\x20margin-left:\x205px;\x22>Eliminar</button>':'')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</li>')['join']('')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</ul>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h4\x20style=\x22margin-top:\x2020px;\x22>Crear\x20Nueva\x20√Årea</h4>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20id=\x22newAreaInput\x22\x20placeholder=\x22Nombre\x20de\x20√Årea\x20(ej.\x20ENSAMBLE)\x22\x20style=\x22text-transform:uppercase\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20id=\x22newPasswordInput\x22\x20placeholder=\x22Contrase√±a\x20para\x20la\x20nueva\x20√°rea\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22createAreaBtn\x22\x20class=\x22btn\x22\x20style=\x22margin-top:\x2010px;\x22>Crear\x20√Årea</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22masterConfigSection\x22\x20class=\x22admin-section\x22\x20style=\x22display:\x20block;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22admin-section-header\x22>Configuraci√≥n\x20de\x20Workshop\x20General</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22admin-section-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22config-item\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20for=\x22masterColumnInput\x22>Columna\x20de\x20C√≥digo\x20de\x20√Årea:</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20id=\x22masterColumnInput\x22\x20value=\x22'+I['column']+'\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h4>Mapeo\x20de\x20C√≥digos\x20a\x20√Åreas</h4>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<ul\x20id=\x22areaMappingList\x22\x20class=\x22area-list\x22></ul>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22addMappingBtn\x22\x20class=\x22btn\x22\x20style=\x22width:\x20auto;\x20padding:\x205px\x2010px;\x20margin-top:\x2010px;\x22>A√±adir\x20Mapeo</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22saveWorkshopConfigBtn\x22\x20class=\x22btn\x22\x20style=\x22margin-top:\x2020px;\x22>Guardar\x20Configuraci√≥n\x20General</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>';Ip('Panel\x20de\x20Administrador',qx),h('createUserBtn')['addEventListener']('click',()=>qP(null)),h('modalBody')['querySelectorAll']('.edit-user-btn')['forEach'](qL=>{qL['addEventListener']('click',qN=>{const qG=qN['target']['dataset']['id'],qM=qh['find'](qy=>qy['id']===qG);qP(qM);});}),h('modalBody')['querySelectorAll']('.delete-user-btn')['forEach'](qL=>{qL['addEventListener']('click',qN=>{const qG=qN['target']['dataset']['id'];IR('¬øSeguro\x20que\x20quieres\x20eliminar\x20al\x20usuario\x20\x22'+qG+'\x22?',async()=>{await db['collection']('users')['doc'](qG)['delete'](),qB();});});}),h('modalBody')['querySelectorAll']('.admin-section-header')['forEach'](qL=>{qL['addEventListener']('click',()=>{qL['parentElement']['classList']['toggle']('expanded');});});const qZ=h('areaMappingList');qZ['innerHTML']='';for(const qL in I['mapping']){const qN=I['mapping'][qL];qZ['appendChild'](qo(qL,qN));}h('addMappingBtn')['addEventListener']('click',()=>{qZ['appendChild'](qo('',''));}),h('saveWorkshopConfigBtn')['addEventListener']('click',qd),h('createAreaBtn')['addEventListener']('click',async()=>{const qG=h('newAreaInput')['value']['trim']()['toUpperCase'](),qM=h('newPasswordInput')['value']['trim']();qG&&qM?(await db['collection']('areas')['doc'](qG)['set']({'name':qG,'password':qM,'isMaster':![],'createdAt':new Date()}),qB()):Ip('Atenci√≥n','Debes\x20especificar\x20un\x20nombre\x20y\x20una\x20contrase√±a\x20para\x20la\x20nueva\x20√°rea.','warning');}),h('modalBody')['querySelectorAll']('.save-area-btn')['forEach'](qG=>{qG['addEventListener']('click',async qM=>{const qy=qM['target']['dataset']['id'],qT=h('modalBody')['querySelector']('.area-password-input[data-id=\x22'+qy+'\x22]')['value']['trim']();qT&&(await db['collection']('areas')['doc'](qy)['update']({'password':qT}),qB());});}),h('modalBody')['querySelectorAll']('.delete-area-btn')['forEach'](qG=>{qG['addEventListener']('click',qM=>{const qy=qM['target']['dataset']['id'];IR('¬øSeguro\x20que\x20quieres\x20eliminar\x20el\x20√°rea\x20\x22'+qy+'\x22\x20y\x20todos\x20sus\x20datos?',async()=>{await qw(qy),qB();});});});}async function qP(qK=null){const qH=qK!==null,qm=qH?'Editar\x20Usuario:\x20'+qK['username']:'Crear\x20Nuevo\x20Usuario',qh=await db['collection']('areas')['get']();let qx=[];qh['forEach'](qL=>{if(qL['id']!=='CONFIG')qx['push']({'id':qL['id'],...qL['data']()});}),qx['sort']((qL,qN)=>qL['id']['localeCompare'](qN['id']));let qZ='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20id=\x22modalUserInput\x22\x20placeholder=\x22Nombre\x20de\x20Usuario\x22\x20style=\x22text-transform:uppercase\x22\x20value=\x22'+(qH?qK['username']:'')+'\x22\x20'+(qH?'disabled':'')+'>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20id=\x22modalPasswordInput\x22\x20placeholder=\x22'+(qH?'Nueva\x20contrase√±a\x20(dejar\x20en\x20blanco\x20para\x20no\x20cambiar)':'Contrase√±a')+'\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h5\x20style=\x22margin-top:16px;\x20margin-bottom:\x208px;\x22>Permisos\x20de\x20√Årea:</h5>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22modalPermissions\x22\x20class=\x22permissions-list\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+qx['map'](qL=>{const qN=qH&&qK['permissions']&&qK['permissions']['includes'](qL['id']);return'<label><input\x20type=\x22checkbox\x22\x20value=\x22'+qL['id']+'\x22\x20'+(qN?'checked':'')+'>'+qL['name']+'</label>';})['join']('')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22margin-top:\x2016px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20gap:\x208px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22checkbox\x22\x20id=\x22modalIsMasterInput\x22\x20style=\x22width:\x20auto;\x20margin:\x200;\x22\x20'+(qH&&qK['isMaster']?'checked':'')+'>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Asignar\x20permisos\x20de\x20Administrador\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22saveUserBtn\x22\x20class=\x22btn\x22\x20style=\x22margin-top:\x2020px;\x22>'+(qH?'Guardar\x20Cambios':'Crear\x20Usuario')+'</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';Ip(qm,qZ),h('saveUserBtn')['onclick']=async()=>{const qL=h('modalUserInput')['value']['trim']()['toUpperCase'](),qN=h('modalPasswordInput')['value']['trim']();if(!qL||!qH&&!qN){Ip('Error','El\x20nombre\x20de\x20usuario\x20y\x20la\x20contrase√±a\x20son\x20obligatorios.','error');return;}const qG=Array['from'](h('modalPermissions')['querySelectorAll']('input:checked'))['map'](qT=>qT['value']),qM=h('modalIsMasterInput')['checked'],qy={'username':qL,'permissions':qG,'isMaster':qM};qN&&(qy['password']=qN),await db['collection']('users')['doc'](qL)['set'](qy,{'merge':!![]}),qB();};}async function qw(qK){const qH=['orders','sap_data'];for(const qm of qH){const qh=await db['collection']('areas')['doc'](qK)['collection'](qm)['get'](),qx=db['batch']();qh['docs']['forEach'](qZ=>qx['delete'](qZ['ref'])),await qx['commit']();}await db['collection']('areas')['doc'](qK)['delete']();}function qo(qK,qH){const qm=document['createElement']('li');return qm['className']='mapping-item',qm['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20class=\x22mapping-code\x22\x20placeholder=\x22C√≥digo\x20(ej.\x20K46)\x22\x20value=\x22'+qK+'\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20class=\x22mapping-area\x22\x20placeholder=\x22Nombre\x20de\x20√Årea\x22\x20value=\x22'+qH+'\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x20btn-danger\x22\x20style=\x22width:\x20auto;\x20padding:\x205px\x2010px;\x22\x20onclick=\x22this.parentElement.remove()\x22>X</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',qm;}async function qd(){const qK=h('masterColumnInput')['value']['trim']()['toUpperCase']()||'C',qH={};h('areaMappingList')['querySelectorAll']('.mapping-item')['forEach'](qh=>{const qx=qh['querySelector']('.mapping-code')['value']['trim']()['toUpperCase'](),qZ=qh['querySelector']('.mapping-area')['value']['trim']()['toUpperCase']();qx&&qZ&&(qH[qx]=qZ);});const qm={'column':qK,'mapping':qH};try{await db['collection']('areas')['doc']('CONFIG')['set']({'general_workshop':qm},{'merge':!![]}),I=qm,Ip('√âxito','La\x20configuraci√≥n\x20del\x20workshop\x20general\x20ha\x20sido\x20guardada.','success');}catch(qh){console['error']('Error\x20guardando\x20configuraci√≥n:',qh),Ip('Error','No\x20se\x20pudo\x20guardar\x20la\x20configuraci√≥n.','error');}}async function qY(){try{const qK=await db['collection']('areas')['doc']('CONFIG')['get']();qK['exists']&&qK['data']()['general_workshop']?(I=qK['data']()['general_workshop'],console['log']('Configuraci√≥n\x20de\x20workshop\x20cargada\x20desde\x20Firebase.')):console['log']('No\x20se\x20encontr√≥\x20configuraci√≥n\x20de\x20workshop,\x20usando\x20valores\x20por\x20defecto.');}catch(qH){console['error']('Error\x20cargando\x20configuraci√≥n\x20de\x20workshop:',qH);}}async function qe(){Ip('Plan\x20del\x20D√≠a','<h4\x20style=\x22text-align:\x20center;\x22>Cargando\x20reporte...</h4>');try{const qK=new Date()['toLocaleDateString']('es-ES',{'timeZone':m,'day':'2-digit','month':'2-digit','year':'numeric'}),qH=await db['collection']('areas')['get'](),qm=qH['docs']['filter'](qG=>qG['id']!=='CONFIG'),qh=qm['map'](qG=>qG['ref']['collection']('sap_data')['doc']('current_data')['get']()),qx=await Promise['all'](qh);let qZ={},qL=0x0;qx['forEach']((qG,qM)=>{if(qG['exists']){const qy=qm[qM]['id'],qT=qG['data']()['orders']||[],qb=qT['filter'](qO=>q4(qO)&&qO['status']!=='complete'),qt=qb['length'];qt>0x0&&(qZ[qy]=qt,qL+=qt);}});let qN='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22daily-plan-modal\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22plan-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22plan-stat\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>√ìrdenes\x20Pendientes</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>'+qL+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22plan-date\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>Fecha</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>'+qK+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22plan-title-separator\x22>Plan\x20de\x20Trabajo\x20por\x20√Årea</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<ul\x20class=\x22plan-area-list\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';if(qL>0x0){const qG=Object['keys'](qZ)['sort']();for(const qM of qG){qN+='<li\x20class=\x22plan-area-item\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22area-name\x22>'+qM+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22area-count\x22>'+qZ[qM]+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</li>';}}else qN+='<li\x20class=\x22plan-area-item-empty\x22>No\x20hay\x20√≥rdenes\x20pendientes\x20para\x20el\x20d√≠a\x20de\x20hoy.</li>';qN+='</ul></div>',Ip('Plan\x20del\x20D√≠a',qN);}catch(qy){console['error']('Error\x20al\x20generar\x20el\x20reporte\x20del\x20plan\x20diario:',qy),Ip('Error','No\x20se\x20pudo\x20generar\x20el\x20reporte\x20del\x20plan\x20diario.','error');}}let qp=localStorage['getItem']('theme')||'dark';function qR(qK){document['body']['className']=qK+'-theme';const qH='<svg\x20xmlns=\x22http://www.w3.org/2000/svg\x22\x20width=\x2220\x22\x20height=\x2220\x22\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22><circle\x20cx=\x2212\x22\x20cy=\x2212\x22\x20r=\x225\x22></circle><line\x20x1=\x2212\x22\x20y1=\x221\x22\x20x2=\x2212\x22\x20y2=\x223\x22></line><line\x20x1=\x2212\x22\x20y1=\x2221\x22\x20x2=\x2212\x22\x20y2=\x2223\x22></line><line\x20x1=\x224.22\x22\x20y1=\x224.22\x22\x20x2=\x225.64\x22\x20y2=\x225.64\x22></line><line\x20x1=\x2218.36\x22\x20y1=\x2218.36\x22\x20x2=\x2219.78\x22\x20y2=\x2219.78\x22></line><line\x20x1=\x221\x22\x20y1=\x2212\x22\x20x2=\x223\x22\x20y2=\x2212\x22></line><line\x20x1=\x2221\x22\x20y1=\x2212\x22\x20x2=\x2223\x22\x20y2=\x2212\x22></line><line\x20x1=\x224.22\x22\x20y1=\x2219.78\x22\x20x2=\x225.64\x22\x20y2=\x2218.36\x22></line><line\x20x1=\x2218.36\x22\x20y1=\x225.64\x22\x20x2=\x2219.78\x22\x20y2=\x224.22\x22></line></svg>',qm='<svg\x20xmlns=\x22http://www.w3.org/2000/svg\x22\x20width=\x2220\x22\x20height=\x2220\x22\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22><path\x20d=\x22M21\x2012.79A9\x209\x200\x201\x201\x2011.21\x203\x207\x207\x200\x200\x200\x2021\x2012.79z\x22></path></svg>';s['innerHTML']=qK==='light'?qm:qH;}function qF(){requestAnimationFrame(()=>{const qK=window['innerWidth']<=0x3e0;if(qK)return;const qH=document['querySelector']('#fwdView\x20.header'),qm=document['getElementById']('table-controls-header'),qh=document['querySelector']('#sapView\x20.global-header'),qx=document['getElementById']('sap-controls-header');if(qH&&qm){const qZ=qH['offsetHeight'],qL=0x10+qZ;qm['style']['top']=qL+'px';}if(qh&&qx){const qN=qh['offsetHeight'],qG=0x10+qN;qx['style']['top']=qG+'px';}});}s['addEventListener']('click',()=>{qp=qp==='light'?'dark':'light',localStorage['setItem']('theme',qp),qR(qp);});function qa(qK){if(!qK)return;if(V)V();if(C)C();const qH=new Date();qH['setDate'](qH['getDate']()-0x1f),console['log']('üì°\x20Iniciando\x20listeners\x20para\x20'+qK+'\x20(Datos\x20desde:\x20'+qH['toLocaleDateString']()+')'),V=db['collection']('areas')['doc'](qK)['collection']('orders')['where']('orderDate','>=',qH)['onSnapshot'](qm=>{const qh=new Map();qm['forEach'](qx=>{const qZ=qx['data']();qZ['orderDate']&&qZ['orderDate']['toDate']&&(qZ['orderDate']=qZ['orderDate']['toDate']());qZ['lastUpdated']&&qZ['lastUpdated']['toDate']&&(qZ['lastUpdated']=qZ['lastUpdated']['toDate']());const qL=new Map();qZ['empaqueData']&&Array['isArray'](qZ['empaqueData'])&&qZ['empaqueData']['forEach'](qN=>{qL['set'](qN['boxId'],qN['serials']);}),qZ['empaqueData']=qL,qh['set'](qx['id'],qZ);}),q=qh,q9(),IL();if(Y==='fwd')IM();},qm=>{console['error']('Error\x20escuchando\x20datos\x20de\x20FWD:\x20',qm),qm['code']==='failed-precondition'?Ip('Requiere\x20√çndice','Abre\x20la\x20consola\x20del\x20navegador\x20(F12)\x20y\x20haz\x20clic\x20en\x20el\x20link\x20de\x20Firebase\x20para\x20crear\x20el\x20√≠ndice\x20de\x20orderDate.','warning'):Ip('Error\x20de\x20Conexi√≥n','No\x20se\x20pudo\x20conectar\x20a\x20los\x20datos\x20del\x20√°rea\x20'+qK+'.','error');}),C=db['collection']('areas')['doc'](qK)['collection']('sap_historico')['where']('lastUpdated','>=',qH)['onSnapshot'](qm=>{let qh=[],qx=null,qZ=null;qm['forEach'](qL=>{const qN=qL['data']();qh['push'](qN);const qG=qN['lastUpdated']?qN['lastUpdated']['toDate']():null;qG&&(!qx||qG>qx)&&(qx=qG,qZ=qN['lastUpdatedBy']);}),n=qh,B=qx,P=qZ,q9(),IL(),Y==='sap'&&IM();},qm=>{console['error']('Error\x20escuchando\x20datos\x20del\x20hist√≥rico\x20de\x20SAP:\x20',qm);});}let qD=window['innerWidth']<=0x3e0;const qV=['uploadCard','orderListCard','filtersCard','actionsCard','sap-uploadCard','sap-orderListCard'];function qC(){qV['forEach'](qK=>{const qH=h(qK);if(!qH)return;qH['classList']['add']('mobile-collapsible');const qm=qH['querySelector']('h3');qm&&(qm['classList']['add']('mobile-trigger'),!qm['dataset']['mobileListener']&&(qm['addEventListener']('click',qh=>{window['innerWidth']<=0x3e0&&qh['currentTarget']['closest']('.card')['classList']['toggle']('expanded');}),qm['dataset']['mobileListener']='true'));});}function qS(){qV['forEach'](qK=>{const qH=h(qK);if(!qH)return;qH['classList']['remove']('mobile-collapsible','expanded');const qm=qH['querySelector']('h3');if(qm)qm['classList']['remove']('mobile-trigger');});}let qj;window['addEventListener']('resize',()=>{clearTimeout(qj),qj=setTimeout(()=>{const qK=window['innerWidth']<=0x3e0;if(qK!==qD){qD=qK;if(qD)qC();else qS();IM();}qF();},0xc8);}),window['copySerialNumber']=function(qK,qH){if(!qH)return;const qm=qH['startsWith']('S#')?qH['substring'](0x2):qH;IY(qm,()=>{const qh=qK['textContent'];qK['textContent']='¬°Copiado!',qK['style']['fontWeight']='bold',qK['style']['color']='var(--success-color)',setTimeout(()=>{qK['textContent']=qh,qK['style']['fontWeight']='',qK['style']['color']='';},0x5dc);},qh=>{console['error']('Error\x20al\x20copiar\x20el\x20n√∫mero\x20de\x20serie:\x20',qh);const qx=qK['textContent'];qK['textContent']='Error',setTimeout(()=>{qK['textContent']=qx;},0x5dc);});};async function qW(){await qY();const qK=db['collection']('users')['doc']('MULTIPORT'),qH=await qK['get']();!qH['exists']&&(await qK['set']({'username':'MULTIPORT','password':'CORNING25','isMaster':!![],'permissions':[]}),console['log']('Usuario\x20maestro\x20\x27MULTIPORT\x27\x20creado.'));const qm=db['collection']('areas')['doc']('MULTIPORT'),qh=await qm['get']();!qh['exists']&&(await qm['set']({'name':'MULTIPORT','password':'CORNING25','isMaster':!![]},{'merge':!![]}),console['log']('√Årea\x20maestra\x20\x27MULTIPORT\x27\x20verificada\x20y\x20asegurada.'));Y=localStorage['getItem']('mainMode')||'fwd',D=localStorage['getItem']('currentArea')||'MULTIPORT',qR(qp),Iq['classList']['toggle']('active',Y==='fwd'),IQ['classList']['toggle']('active',Y==='sap'),h('fwdView')['style']['display']=Y==='fwd'?'block':'none',h('sapView')['style']['display']=Y==='sap'?'block':'none',h('fwdView')['style']['opacity']=Y==='fwd'?'1':'0',h('sapView')['style']['opacity']=Y==='sap'?'1':'0';if(qD)qC();const qx=sessionStorage['getItem']('appSession');qx&&(a=JSON['parse'](qx)),qf(),qa(D),setTimeout(qF,0x1f4);}'serviceWorker'in navigator&&window['addEventListener']('load',()=>{navigator['serviceWorker']['register']('sw.js')['then'](qK=>{console['log']('‚úÖ\x20Service\x20Worker\x20registrado\x20con\x20√©xito.\x20Alcance:',qK['scope']);})['catch'](qK=>{console['log']('‚ùå\x20Error\x20al\x20registrar\x20el\x20Service\x20Worker:',qK);});}),qW();});
