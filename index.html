<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rastreo de √ìrdenes de Producci√≥n</title>
<style>
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        margin: 0;
        padding: 20px;
        background-color: #f4f6f9;
        color: #333;
    }
    header {
        text-align: center;
        margin-bottom: 20px;
    }
    header h1 {
        margin: 0;
        font-size: 1.8em;
        color: #2c3e50;
    }
    .upload-section {
        text-align: center;
        margin-bottom: 20px;
    }
    .upload-section input, 
    .upload-section button {
        margin: 5px;
        padding: 10px 15px;
        border: none;
        border-radius: 6px;
        font-size: 0.95em;
    }
    .upload-section input[type=file] {
        background: #fff;
        border: 1px solid #ccc;
        cursor: pointer;
    }
    .upload-section button {
        background: #2980b9;
        color: white;
        cursor: pointer;
    }
    .upload-section button:hover {
        background: #1f6391;
    }
    .cards {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin-bottom: 25px;
        flex-wrap: wrap;
    }
    .card {
        background: white;
        padding: 15px 20px;
        border-radius: 8px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        text-align: center;
        min-width: 160px;
    }
    .card h3 {
        margin: 0;
        font-size: 1em;
        color: #555;
    }
    .card p {
        font-size: 1.3em;
        font-weight: bold;
        color: #2c3e50;
    }
    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
        background: white;
        border-radius: 6px;
        overflow: hidden;
        box-shadow: 0 1px 4px rgba(0,0,0,0.1);
    }
    th, td {
        padding: 10px 12px;
        text-align: left;
        font-size: 0.9em;
    }
    th {
        background: #2980b9;
        color: white;
    }
    tr:nth-child(even) {
        background: #f9f9f9;
    }
    tr:hover {
        background: #ecf6ff;
    }
    tr.scrap {
        background-color: #ffcccc !important; /* Rojo */
    }
    tr.sin-movimiento {
        background-color: #fff3cd !important; /* Amarillo */
    }
    .filters {
        margin: 15px 0;
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
    }
    .filters select {
        padding: 8px 12px;
        border: 1px solid #ccc;
        border-radius: 6px;
        font-size: 0.9em;
        background: white;
    }
    .actions {
        text-align: right;
        margin-top: 10px;
    }
    .actions button {
        background: #27ae60;
        color: white;
        padding: 8px 12px;
        margin-left: 10px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 0.9em;
    }
    .actions button:hover {
        background: #1e8449;
    }
</style>
</head>
<body>
<header>
    <h1>üìä Rastreo de √ìrdenes de Producci√≥n</h1>
</header>

<section class="upload-section">
    <input type="file" id="fileInput" accept=".csv, .xlsx">
    <button onclick="analizarDatos()">Analizar Datos</button>
</section>

<section class="cards">
    <div class="card">
        <h3>Total Seriales</h3>
        <p id="totalSeriales">0</p>
    </div>
    <div class="card">
        <h3>Scrap</h3>
        <p id="totalScrap">0</p>
    </div>
    <div class="card">
        <h3>No Empacados</h3>
        <p id="totalNotPacked">0</p>
    </div>
    <div class="card">
        <h3>Sin Movimiento</h3>
        <p id="totalSinMovimiento">0</p>
    </div>
</section>

<section class="filters" id="filters"></section>

<table id="tablaResultados">
    <thead>
        <tr>
            <th>Serial</th>
            <th>Creation Date</th>
            <th>Created By</th>
            <th>NotPacked</th>
            <th>IsScrap</th>
            <th>√Årea</th>
            <th>L√≠nea</th>
            <th>Station</th>
            <th>Status</th>
            <th>Date Registered</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<div class="actions">
    <button onclick="copiarTabla()">Copiar Tabla</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script>
let datos = [];

function analizarDatos() {
    const input = document.getElementById('fileInput');
    if (!input.files.length) {
        alert("Sube un archivo primero.");
        return;
    }

    const reader = new FileReader();
    reader.onload = function(e) {
        const data = new Uint8Array(e.target.result);
        const workbook = XLSX.read(data, { type: 'array' });
        const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
        datos = XLSX.utils.sheet_to_json(firstSheet, { defval: "" });
        mostrarDatos(datos);
    };
    reader.readAsArrayBuffer(input.files[0]);
}

function mostrarDatos(registros) {
    const tbody = document.querySelector("#tablaResultados tbody");
    tbody.innerHTML = "";

    let totalSeriales = registros.length;
    let totalScrap = 0;
    let totalNotPacked = 0;
    let totalSinMovimiento = 0;

    const hoy = new Date();
    const ayer = new Date(hoy);
    ayer.setDate(hoy.getDate() - 1);

    registros.forEach(r => {
        const fila = document.createElement("tr");

        let fecha = new Date(r["Date registered"]);
        let sinMovimiento = !(fecha.toDateString() === hoy.toDateString() || fecha.toDateString() === ayer.toDateString());

        if (r["IsScrap"].toString().toLowerCase() === "true") {
            fila.classList.add("scrap");
            totalScrap++;
        }
        if (r["NotPacked"].toString().toLowerCase() === "true") {
            totalNotPacked++;
        }
        if (sinMovimiento) {
            fila.classList.add("sin-movimiento");
            totalSinMovimiento++;
        }

        fila.innerHTML = `
            <td>${r["Serial"]}</td>
            <td>${r["Creation Date"]}</td>
            <td>${r["Created By"]}</td>
            <td>${r["NotPacked"]}</td>
            <td>${r["IsScrap"]}</td>
            <td>${r["√Årea"]}</td>
            <td>${r["L√≠nea"]}</td>
            <td>${r["Station"]}</td>
            <td>${r["Status"]}</td>
            <td>${r["Date registered"]}</td>
        `;

        tbody.appendChild(fila);
    });

    document.getElementById("totalSeriales").innerText = totalSeriales;
    document.getElementById("totalScrap").innerText = totalScrap;
    document.getElementById("totalNotPacked").innerText = totalNotPacked;
    document.getElementById("totalSinMovimiento").innerText = totalSinMovimiento;
}

function copiarTabla() {
    const tabla = document.getElementById("tablaResultados").outerHTML;
    navigator.clipboard.writeText(tabla).then(() => {
        alert("Tabla copiada al portapapeles");
    });
}
</script>
</body>
</html>